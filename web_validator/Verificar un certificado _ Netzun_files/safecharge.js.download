/*v1.141.0	 	rev #4f9a7a4, built on 2024-08-05 17:03:24*/
var websdk_core=function(e){"use strict";const a=()=>{for(var e=0;e<document.scripts.length;e++){var t=document.scripts[e],n=-1<t.src.lastIndexOf("/safecharge.js")?t.src.lastIndexOf("/safecharge.js"):t.src.lastIndexOf("/websdk.js");if(-1<n)return t.src.substr(0,n+1)}};function i(e){var t={};try{t=JSON.parse(e)}catch{t={error:{type:"network",code:"invalid response",message:"Nuvei Server returned invalid response"}}}return t}return e.blockCardsChecker=(e,t)=>{var n=[];return e.forEach(function(e){e=Array.isArray(e)?e:[e];-1===e.map(function(e){e=e.toLocaleLowerCase();return t.brand&&e===t.brand.toLocaleLowerCase()||t.cardType&&e===t.cardType.toLocaleLowerCase()||t.issuerCountry&&e===t.issuerCountry.toLocaleLowerCase()||t.cardProduct&&e===t.cardProduct.toLocaleLowerCase()||!0===t.isPrepaid&&"prepaid"===e}).indexOf(!1)&&(n=n.concat(e))}),!!n.length&&n},e.findSfcHost=a,e.inject3Dmodal=e=>{var t;(function(e){let t=document.createElement("div");t.id=e,t.style.cssText="display: display; overflow: auto; position: fixed; z-index: 9999; outline: 0px; background-color: rgba(210, 204, 204, 0.5); top: 0px; right: 0px; left: 0px; bottom: 0px;",t.innerHTML=`<div class="sfcModal-dialog">
        <div class="sfcModal-content" style="position:relative;background-color:#fff;background-clip:padding-box;outline:0;border:1px solid #dfdfdf;">
            <div class="sfcModal-header">
                <a role="button" data-dismiss="modal" aria-label="Close" class="sfcIcon--close sfcModal-close"></a>
            </div>
            <div class="sfcModal-body" style="-webkit-overflow-scrolling: touch;">
            </div>
        </div>
    </div>`,document.body.appendChild(t)})(e),document.getElementById(e).style.display="block",setTimeout(function(){document.getElementById(e).classList.add("is-in")},300);var n=document.createElement("iframe"),o="NuveiIrame";n.setAttribute("id","ifrm"),n.style.cssText="height: 420px;border: none !important; margin: 0 !important;padding: 0 !important;width: 1px !important;min-width: 100% !important;overflow: hidden !important;display: block !important;",n.setAttribute("name",o),n.setAttribute("src",a()+"preloader.html?"+(new Date).getTime());var r=document.getElementsByClassName("sfcModal-body")[0];return null==(t=null==r?void 0:r.parentNode)||t.insertBefore(n,r),o},e.loadJS=e=>{var t=document.createElement("script");t.type="text/javascript",t.src=e,t.crossOrigin="anonymous",t.setAttribute("id","dynatraceScript"),document.head.appendChild(t)},e.loadScript=(e,t)=>{var n=document.createElement("script");n.type="text/javascript",n.crossOrigin="anonymous",n.onload=function(){t()},n.src=e,document.head.appendChild(n)},e.onPaymentEvent=(e,t,n,o,r)=>{"function"==typeof t&&("paymentStarted"===e.eventType&&e.threeD&&"true"===o&&!n&&(e.threeD.flow="frictionless"),r&&(e.pm=r),t(e))},e.xhrPost=(e,t,n,o)=>{var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.setRequestHeader("X-API-KEY",t),r.timeout=6e4,r.onerror=function(){o({result:{status:"ERROR",type:"network",code:"connection_lost",errorDescription:"Connection to Nuvei server lost.",event:"error"}})},r.ontimeout=function(){o({result:{status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Nuvei server timed out.",event:"timeout"}})},r.onabort=function(){var e=i(r.responseText);o({result:e})},r.onload=function(){var e=i(r.responseText);o(e)},r.send(JSON.stringify(n))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),e}({});String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n},writable:!0,configurable:!0}),"NodeList"in window&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n}),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),o=n.length>>>0,r=arguments[1],a=0;a<o;a++)if(t=n[a],e.call(r,t,a,n))return t}),function(){function e(){null!=this.parentNode&&this.parentNode.removeChild(this)}for(var t=["DocumentType","Element","CharacterData"],n=0;n<t.length;n++){var o=t[n];window[o]&&!window[o].prototype.remove&&(window[o].prototype.remove=e)}}(),function(e){e.ulog=function(){"use strict";var o,r,a,i;function s(e){return e?i[e]?i[e]:i[e]=n({name:e},s):s.debug?s:n(s)}s.ulog={version:"1.1.0"},s.enable=function(e){var t,n=(e||"").split(/[\s,]+/);for(t=0;t<n.length;t++)if(n[t]){e=n[t].replace(/\*/g,".*?");if(e[0]==="-")o.push(new RegExp("^"+e.substr(1)+"$"));else r.push(new RegExp("^"+e+"$"))}for(t in i)p(i[t])},s.enabled=function(e){var t;for(t=0;t<o.length;t++)if(o[t].test(e))return;for(t=0;t<r.length;t++)if(r[t].test(e))return true},s.disable=s.enable.bind(s,"");var t={ERROR:1,WARN:2,INFO:3,LOG:4,DEBUG:5,TRACE:6},c=Object.keys(t).map(function(e){return e.toLowerCase()}),i={},r=[],o=[];function n(n,o,r){n.NONE=0;for(var e in t)n[e]=t[e];Object.defineProperty(n,"level",{get:function(){return r!==undefined?r:o&&o.level},set:function(e){if(e===undefined&&o)r=undefined;else{var t=e&&(Number(e)!==Number(e)?n[e.toUpperCase()]:Number(e));if(t>=0&&t<=6)r=t}p(n);if(!o)for(a in i)p(i[a])}});p(n,o);n.dir=d("dir")||l;n.table=d("table")||l;n.time=d("time")||l;n.timeEnd=d("timeEnd")||l;n.assert=typeof window=="object"&&d("assert")||function(){var e=[].concat.apply([],arguments),t=e.shift();if(!t)n.error.apply(n,e)};return n}function p(e){var t=Math.max(e.name&&s.enabled(e.name)&&e.DEBUG||e.level,e.level);for(var n=0,o;o=c[n];n++)e[o]=t<=n?l:d(o)||typeof print=="function"&&print||l}function d(e,t){return(t=s.con())&&(t[e]||t.log).bind(t)}function l(){}var e=location.search.substring(1),m=e&&e.split("&"),u,y,h,f;try{u=localStorage.getItem("log");y=localStorage.getItem("debug")}catch(e){}for(h=0;f=m&&m[h]&&m[h].split("=");h++){f[0]=="log"?u=f[1]:0;f[0]=="debug"?y=f[1]:0}s.con=function(){return window.console&&console},y&&s.enable(y);var v=s();return s.level=u||s.WARN,v}()}(this);var applePay=function(){},session=null,mapApplePayDetailsToNuveiApi=function(e,t){return void 0===t&&(t={}),void 0===(e=void 0===e?{}:e).addressLines&&(e.addressLines=[]),void 0===t.addressLines&&(t.addressLines=[]),{firstName:e.givenName||t.givenName,lastName:e.familyName||t.familyName,country:e.countryCode||t.countryCode,email:e.emailAddress||t.emailAddress,address:e.addressLines[0]||t.addressLines[0],addressLine2:e.addressLines[1]||t.addressLines[1],phone:e.phoneNumber||t.phoneNumber,zip:e.postalCode||t.postalCode,city:e.locality||t.locality,state:e.administrativeArea||t.administrativeArea}};function toCSS(e,i){var h={};function f(e,t,n){"number"!=typeof n||i.useRawValues||(n+="px");for(var o=t.split(/\s*,\s*/),r=0;r<o.length;r++){var a=o[r].replace(/_/g,"-");h[e][a]?h[e][a].push(n):h[e][a]=[n]}}if("string"==typeof e)return"/*\nUnable to parse JSS: "+e+"\n*/";!function e(t,n){for(var o in t&&!h[t]&&(h[t]={}),n){var r=n[o];if(r instanceof Array)for(var a=r,i=0;i<a.length;i++)f(t,o,a[i]);else switch(typeof r){case"number":case"string":f(t,o,r);break;case"object":var s=o.charAt(o.length-1);if(!t||"_"!==s&&"-"!==s)e(function(e,t){for(var n=[],o=t.split(/\s*,\s*/),r=e.split(/\s*,\s*/),a=0;a<r.length;a++)for(var i=r[a],s=0;s<o.length;s++){var c=o[s];"&"===c.charAt(0)?n.push(i+c.substr(1)):n.push(i?i+" "+c:c)}return n.join(", ")}(t,o),r);else{var c,p=r;for(c in p)for(var d=c.split(/\s*,\s*/),l=0;l<d.length;l++){var m=p[c];if(m instanceof Array)for(var u=m,y=0;y<u.length;y++)f(t,o+d[l],u[y]);else f(t,o+d[l],p[c])}}}}}("",e);var t,n="";for(t in h){var o,r=h[t];for(o in n+=t+" {\n",r)for(var a=r[o],s=0;s<a.length;s++)n+="\t"+o+": "+a[s]+";\n";n+="}\n"}return n}applePay.prototype.buildSession=function(e,n,t){this.request=e,this.request.supportedNetworks=e.supportedNetworks||["amex","chinaUnionPay","privateLabel","discover","visa","masterCard","jcb"],this.request.merchantCapabilities=e.merchantCapabilities||["supports3DS","supportsCredit","supportsDebit"];var i=e.server,s=this.request.merchantSiteId;"true"===e.collectUserDetails&&(this.request.requiredBillingContactFields=["postalAddress","name","phone","email"],this.request.requiredShippingContactFields=["postalAddress","name","phone","email"]),delete e.collectUserDetails;e=1;ApplePaySession.supportsVersion(3)?e=3:ApplePaySession.supportsVersion(2)?e=2:ApplePaySession.supportsVersion(4)&&(e=4),delete this.request.server,delete this.request.merchantSiteId,session=new ApplePaySession(e,this.request);return session.onvalidatemerchant=function(e){var o,r,a;o=e.validationURL,r=s,a="/ppp/getAppleValidationApiFlow.do",new Promise(function(t,e){var n=new XMLHttpRequest;n.onload=function(){var e=JSON.parse(this.responseText);t(e.appleResponse)},n.onerror=e,n.timeout=3e4,n.ontimeout=e,n.open("GET",[i,a,"?merchant_site_id=",r,"&validationUrl=",o,"&ts=",(new Date).getTime()].join("")),n.send()}).then(function(e){session.completeMerchantValidation(e)}).catch(function(e){session.completeMerchantValidation(e)})},session.onpaymentauthorized=function(e){var t={token:e.payment.token};e.payment.billingContact&&(t.billingContact=e.payment.billingContact),e.payment.shippingContact&&(t.shippingContact=e.payment.shippingContact),t.shippingAndBillingDetails=mapApplePayDetailsToNuveiApi(t.shippingContact,t.billingContact),n(t,function(e,t){t=t||[];t={status:e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE,errors:t};session.completePayment(t)})},session.oncancel=function(e){e={status:"canceled",errors:e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE};t(e)},this},applePay.prototype.completePayment=function(e){session.completePayment(e)},applePay.prototype.abort=function(e){e={status:"abort",errors:e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE};applePayCallback(e),session.abort()};var defaults={truncateFirst:!(applePay.prototype.begin=function(){var t=this;this.oncancel&&(session.oncancel=function(e){t.oncancel(e)}),session.begin()}),container:null,containerName:"injectCSSContainer",useRawValues:!1,media:"all"};function injectCSS(e,t){var n=(t=Object.assign(defaults,t)).container||document.getElementById(t.containerName);n||(o=document.head||document.getElementsByTagName("head")[0],(r=document.createElement("style")).type="text/css",r.id=t.containerName,r.media=t.media,o.appendChild(r),n=document.getElementById(t.containerName));var o=void 0!==n.styleSheet&&void 0!==n.styleSheet.cssText,r="";return t.truncateFirst||(r+=o?n.styleSheet.cssText:n.textContent),r+=toCSS(e,t),o?n.styleSheet.cssText=r:n.textContent=r,n}var generateStyles=function(){"use strict";var i=["fontSmoothing"];function s(e,t,n){var o,r={};for(o in r[t]={},n){var a=getRule(o);r[t][a]=n[o]}return r}return function(e,t){var n,o,r={base:"",empty:".empty",valid:".valid",invalid:".invalid"},a={};for(n in t)void 0!==r[n]&&(o=function(t,n){var o,r={};for(o in r[t]={},n){var e,a=getRule(o);"string"==typeof a&&a.startsWith(":")?(e=s(0,t+a,n[o]),Object.assign(r,e)):-1<i.indexOf(o)?a.map(function(e){r[t][e]=n[o]}):"object"==typeof a&&n[o]?a.map(function(e){e=s(0,e,n[o]);Object.assign(r,e)}):a&&(r[t][a]=n[o])}return r}((e+{base:"",empty:".empty",valid:".valid",invalid:".invalid"}[n]).trim(),t[n]),Object.assign(a,o));return a}}();function objectToCSS(n){return Object.keys(n).map(e=>{var t=n[e];return`${getRule(e)}: ${t}`}).join(";")}function getRule(e){return{color:"color",fontFamily:"font-family",fontSize:"font-size",fontSmoothing:["font-smooth","-webkit-font-smoothing","-moz-osx-font-smoothing"],"-webkit-font-smoothing":"-webkit-font-smoothing","-moz-osx-font-smoothing":"-moz-osx-font-smoothing",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",lineHeight:"line-height",letterSpacing:"letter-spacing",textAlign:"text-align",textDecoration:"text-decoration",textShadow:"text-shadow",textTransform:"text-transform","::placeholder":["::-webkit-input-placeholder","::-moz-placeholder",":-ms-input-placeholder",":-moz-placeholder"],"::selection":["::selection","::-moz-selection"],"::-ms-clear":["::-ms-clear"],":-webkit-autofill":":-webkit-autofill",":disabled":":disabled",":focus":":focus",":hover":":hover",border:"border",borderRadius:"border-radius",opacity:"opacity",display:"display",width:"width",boxSizing:"box-sizing",alignItems:"align-items",margin:"margin",maxWidth:"max-width",minWidth:"min-width",flexWrap:"flex-wrap",flexDirection:"flex-direction",height:"height",backgroundColor:"background-color",outline:"outline",cursor:"cursor",zIndex:"z-index",position:"position",top:"top",left:"left",float:"float",clear:"clear",visibility:"visibility",padding:"padding",overflow:"overflow"}[e]}var UUIDjs=function(){"use strict";function s(){}return s.limitUI04=(s.maxFromBits=function(e){return Math.pow(2,e)})(4),s.limitUI06=s.maxFromBits(6),s.limitUI08=s.maxFromBits(8),s.limitUI12=s.maxFromBits(12),s.limitUI14=s.maxFromBits(14),s.limitUI16=s.maxFromBits(16),s.limitUI32=s.maxFromBits(32),s.limitUI40=s.maxFromBits(40),s.limitUI48=s.maxFromBits(48),s.randomUI04=function(){return Math.round(Math.random()*s.limitUI04)},s.randomUI06=function(){return Math.round(Math.random()*s.limitUI06)},s.randomUI08=function(){return Math.round(Math.random()*s.limitUI08)},s.randomUI12=function(){return Math.round(Math.random()*s.limitUI12)},s.randomUI14=function(){return Math.round(Math.random()*s.limitUI14)},s.randomUI16=function(){return Math.round(Math.random()*s.limitUI16)},s.randomUI32=function(){return Math.round(Math.random()*s.limitUI32)},s.randomUI40=function(){return(0|Math.random()*(1<<30))+(0|1024*Math.random())*(1<<30)},s.randomUI48=function(){return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<18))*(1<<30)},s.paddedString=function(e,t,n){n=n||"0";for(var o=t-(e=String(e)).length;0<o;o>>>=1,n+=n)1&o&&(e=n+e);return e},s.prototype.fromParts=function(e,t,n,o,r,a){return this.version=n>>12&15,this.hex=s.paddedString(e.toString(16),8)+"-"+s.paddedString(t.toString(16),4)+"-"+s.paddedString(n.toString(16),4)+"-"+s.paddedString(o.toString(16),2)+s.paddedString(r.toString(16),2)+"-"+s.paddedString(a.toString(16),12),this},s.prototype.toString=function(){return this.hex},s.prototype.toURN=function(){return"urn:uuid:"+this.hex},s.prototype.toBytes=function(){for(var e=this.hex.split("-"),t=[],n=0,o=0;o<e.length;o++)for(var r=0;r<e[o].length;r+=2)t[n++]=parseInt(e[o].substr(r,2),16);return t},s.prototype.equals=function(e){return e instanceof UUID&&this.hex===e.hex},s.getTimeFieldValues=function(e){var t=e-Date.UTC(1582,9,15),e=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&e,hi:e>>>16,timestamp:t}},s._create4=function(){return(new s).fromParts(s.randomUI32(),s.randomUI16(),16384|s.randomUI12(),128|s.randomUI06(),s.randomUI08(),s.randomUI48())},s._create1=function(){var e=(new Date).getTime(),t=s.randomUI14(),n=1099511627776*(1|s.randomUI08())+s.randomUI40(),o=s.randomUI04(),r=0;e!==r?(e<r&&t++,r=e,o=s.randomUI04()):Math.random()<.25&&o<9984?o+=1+s.randomUI04():t++;e=s.getTimeFieldValues(r),r=e.low+o,o=4095&e.hi|4096;return(new s).fromParts(r,e.mid,o,(t&=16383)>>>8|128,255&t,n)},s.create=function(e){return this["_create"+(e=e||4)]()},s.fromTime=function(e,t){t=t||!1;var n=s.getTimeFieldValues(e),o=n.low,e=4095&n.hi|4096;return!1===t?(new s).fromParts(o,n.mid,e,0,0,0):(new s).fromParts(o,n.mid,e,128|s.limitUI06,s.limitUI08-1,s.limitUI48-1)},s.firstFromTime=function(e){return s.fromTime(e,!1)},s.lastFromTime=function(e){return s.fromTime(e,!0)},s.fromURN=function(e){var t;return t===/^(?:urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(?:\})?$/i.exec(e)?(new s).fromParts(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16)):null},s.fromBytes=function(e){var t="",n=0,o=[4,2,2,2,6],r=0;if(e.length<5)return null;for(;r<o.length;r++){for(var a=0;a<o[r];a++){var i=e[n++].toString(16);t+=i=1===i.length?"0"+i:i}6!==o[r]&&(t+="-")}return s.fromURN(t)},s.fromBinary=function(e){for(var t=[],n=0;n<e.length;n++)if(t[n]=e.charCodeAt(n),255<t[n]||t[n]<0)throw new Error("Unexpected byte in binary data.");return s.fromBytes(t)},s}();function openWindow(e,t,o){var n="pppApmWindow_"+(new Date).getTime(),r=null,a={w:800,h:600},i=a.w,s=a.h,c=screen.width/2-i/2,p=screen.height/2-s/2,a="https://cdn.safecharge.com/safecharge_resources/v1/websdk/preloader.html?"+(new Date).getTime();return function e(t,n){window.setTimeout(function(){null==t||null==t.closed||1==t.closed?window.skipGetPayoutStatus||n():e(t,n)},200)}(r=window.open(a,n,"height="+s+",width="+i+",top="+p+",left="+c+",toolbar=yes,location=no,directories=no,status=no,menubar=no,linemenubar=no,scrollbars=yes,resizable=yes,modal=yes"),function(){var n=new XMLHttpRequest;n.open("POST",t+"/ppp/api/v1/getPayoutStatus.do",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.timeout=6e4,n.onerror=function(){o({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},n.ontimeout=function(){return o({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},n.onload=function(){var e,t;200===n.status&&((e=fixIncorrectResult(JSON.parse(n.response))).paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},e={result:e.transactionStatus||e.status,errCode:e.gwExtendedErrorCode||e.gwErrorCode||e.paymentMethodErrorCode||e.errorCode||e.errCode||"0",errorDescription:e.gwErrorReason||e.paymentMethodErrorReason||e.errorDescription||e.reason||"",userPaymentOptionId:e.paymentOption.userPaymentOptionId,ccCardNumber:e.paymentOption.card.ccCardNumber||"",bin:e.paymentOption.card.bin||"",last4Digits:e.paymentOption.card.last4Digits||"",ccExpMonth:e.paymentOption.card.ccExpMonth||"",ccExpYear:e.paymentOption.card.ccExpYear||"",transactionId:e.transactionId,cancelled:!1},t?(t=!1,o(e)):"PENDING"===e.result||"ERROR"===e.result||9072===e.errCode||o(e))},n.send(JSON.stringify({sessionToken:e}))}.bind(this)),r}function mapGooglePayShippingAddress(e){return{firstName:e.name.substring(0,e.name.indexOf(" ")),lastName:e.name.substring(e.name.indexOf(" ")+1),country:e.countryCode,address:e.address1,addressLine2:e.address2,addressLine3:e.address3,zip:e.postalCode,city:e.locality,state:e.administrativeArea,phone:e.phoneNumber}}function mapGooglePaybillingAddress(e){return{firstName:e.name.substring(0,e.name.indexOf(" ")),lastName:e.name.substring(e.name.indexOf(" ")+1),country:e.countryCode,address:e.address1,addressLine2:e.address2,addressLine3:e.address3,zip:e.postalCode,city:e.locality,state:e.administrativeArea,phone:e.phoneNumber}}var util={parseResult:function(e){var t={};try{t=JSON.parse(e)}catch(e){t={error:{type:"network",code:"invalid response",message:"SafeCharge Server returned invalid response"}}}return t}};function setOrderAmount(e,t,n){var o=new XMLHttpRequest;o.open("POST",e+"/ppp/api/v1/websdk/clientSetOrderAmount.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=3e4,o.onerror=function(){n({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},o.ontimeout=function(){return n({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},o.onload=function(){var e;200===o.status&&(e=util.parseResult(o.responseText),n(e))},o.send(JSON.stringify(t))}!function(e){var t,b,r,a,I={},y=null,h=null,f=null,v={},P={},g=ulog("safeCharge"),O="",T={},D=[],E="",C="",k="",i="o2087c6f6-7865-11e9-9143-116d91954306",s=!1,R="card type blocked",_="Connection to Nuvei server timed out.",A="Card does not support 3D secure",c=null,p=null,d=null;function x(e,t){var n=[];return e.forEach(function(e){e=(Array.isArray(e)?e:[e]).map(function(e){e=e.toLocaleLowerCase();return t.brand&&e===t.brand.toLocaleLowerCase()||t.cardType&&e===t.cardType.toLocaleLowerCase()||t.issuerCountry&&e===t.issuerCountry.toLocaleLowerCase()||t.cardProduct&&e===t.cardProduct.toLocaleLowerCase()||!0===t.isPrepaid&&"prepaid"===e});n.push(-1===e.indexOf(!1))}),-1!==n.indexOf(!0)}function n(e){e=e.paymentOption;if(e){if(e.__makePayment||e.card&&e.card.CVV&&e.card.CVV.__makePayment)return"cc_card";if(e.card&&e.card.externalToken&&"GooglePay"===e.card.externalToken.externalTokenProvider)return"ppp_GooglePay";if(e.alternativePaymentMethod&&e.alternativePaymentMethod.paymentMethod)return e.alternativePaymentMethod.paymentMethod;if(e.userPaymentOptionId&&!e.alternativePaymentMethod)return"cc_card";if(e.card&&e.card.cardNumber)return"cc_card"}return""}var o=console;null!==document.getElementById("dynatraceScript")||"localhost"!==window.location.host.slice(0,9)&&"jsfiddle.net"!==window.location.hostname&&"fiddle.jshell.net"!==window.location.hostname&&"gw-4u"!==window.location.hostname.split(".")[1]&&window.location.search;var l=[];function m(){a&&r&&r.end()}function N(){a&&a.shutdown&&a.shutdown()}function M(e){return a&&r?r.enterAction(e):{leaveAction:function(){}}}function U(e){e&&e.leaveAction&&"function"==typeof e.leaveAction&&e.leaveAction()}function u(e,t){if(a&&r){if(a.isInitialized())if("identifyUser"===e)r.identifyUser(t);else{var n,o=r.enterAction(e);for(n in t)o.reportValue(n,t[n]);o.leaveAction()}}else l.push([e,t])}e.dtBuffer=[],e.callDtrum=function(e,t){if("object"==typeof dtrum&&"localhost"!==window.location.host.slice(0,9)){for(;dtBuffer.length;){var n,o=dtBuffer.shift();"enterAction"===o[0]?n=dtrum[o[0]].apply(this,o[1]):"leaveAction"===o[0]?(dtrum[o[0]].apply(this,[n,Date.now()]),n=void 0):dtrum[o[0]].apply(this,o[1])}return n&&(t[0]=n),dtrum[e].apply(this,t)}dtBuffer.push([e,t])};function L(e){(e=e.errorDescription||e.reason||e.error&&e.error.message)&&o.log(`getCardDetails returned error "${e}"`)}function q(o,r){var a;g.info("---\x3e paymentFrame \n"+JSON.stringify(o,null,4)),g.trace("---\x3e paymentFrame \n"),c=o.paymentOption,p=o.transactionId,d=o.ccTempToken,window.nuveiIframeName=websdk_core.inject3Dmodal(i),websdk_core.onPaymentEvent({eventType:"challengeStarted",threeD:{version:c.card.threeD.version||"",flow:"challenge"}},I.onPaymentEvent,k,C,E),window.threeDPaymentActionId=M("challenge_started/challenge_complete"),document.querySelector("a.sfcIcon--close.sfcModal-close").addEventListener("click",function(){setTimeout(function(){document.getElementById(i).style.display="none",F()},300),websdk_core.onPaymentEvent({eventType:"challengeEnded",threeD:{version:c.card.threeD.version||"",flow:"challenge"}},I.onPaymentEvent,k,C,E),callDtrum("sendSessionProperties",[null,null,{"3dauthobject":"cancelled:true"},null]),r({cancelled:!0})},{once:!0}),s||(a=function(e){var t=e.origin,n={};try{n=JSON.parse(e.data)}catch(e){}n.threeDLoad&&t===n.origin&&document.getElementsByName(window.nuveiIframeName)[0].contentWindow.postMessage(JSON.stringify(c),n.origin),g.info("---\x3e Auth 3ds data \n"+JSON.stringify(n,null,4)),g.trace("---\x3e Auth 3ds data \n"),t===I.server&&(n.paRes&&(setTimeout(function(){document.getElementById(i).style.display="none",U(threeDPaymentActionId),F()},300),n.cancelled=!1,websdk_core.onPaymentEvent({eventType:"challengeEnded",threeD:{version:c.card.threeD.version||"",flow:"challenge"}},I.onPaymentEvent,k,C,E),callDtrum("sendSessionProperties",[null,null,{"3dauthobject":JSON.stringify(n)},null]),window.removeEventListener("message",a,!1),s=!1,r(n)),(n.result||""===n.result||n.transactionId||"-5"===n.errCode)&&(setTimeout(function(){document.getElementById(i).style.display="none",F()},300),n.cancelled=!1,"authenticate3d"===o.all.sourceMethod&&(n.ccTempToken=d,n.transactionId=p),websdk_core.onPaymentEvent({eventType:"challengeEnded",threeD:{version:c.card.threeD.version||"",flow:"challenge"}},I.onPaymentEvent,k,C,E),callDtrum("sendSessionProperties",[null,null,{"3dauthobject":JSON.stringify(n)},null]),U(threeDPaymentActionId),s=!1,window.removeEventListener("message",a,!1),r(n)))},window.addEventListener("message",a),s=!0)}e.dtBuffer=[],window.addEventListener("beforeunload",function(){m(),N()});function j(e,t,r){var n=document.createElement("form");n.style.display="none",n.id="u"+UUIDjs.create(1).hex;var a=document.createElement("iframe");a.style.display="none",a.name="i"+UUIDjs.create(1).hex;var o=document.createElement("input");document.body.appendChild(a),n.method="POST",n.action=e,n.target=a.name,o.value=t,o.name="threeDSMethodData",n.appendChild(o),document.body.appendChild(n),o={};try{o=JSON.parse(atob(t))}catch(e){}var i=o.threeDSServerTransID;n.submit();var s=setTimeout(function(){window.removeEventListener("message",c,!1),r("N")},15050),c=function(e){clearTimeout(s),window.removeEventListener("message",c,!1);var t={};if(document.getElementsByName(a.name)[0].remove(),e.data)try{if(2!==(t=JSON.parse(e.data)).response.split("=").length)return r("N");var n=atob(t.response.split("=")[1]),o={threeDSServerTransID:!1};try{o=JSON.parse(n)}catch(e){return r("N")}return o.threeDSServerTransID&&o.threeDSServerTransID===i?r("Y"):r("N")}catch(e){return r("N")}};window.addEventListener("message",c,{once:!0}),document.getElementById(n.id).remove()}function w(e){var t,n,o,r,a,i,s,c,p={};try{p=JSON.parse(e.data)}catch(e){}if("tooltip-action"===p.event){var d,l,m=p.message.payload.data,u=document.getElementById("toolTipMsg"),e=u.getBoundingClientRect();if("hidden"===m.visibility)return void(u.style.visibility=m.visibility);"cvv"===m.field?(u.style.visibility="visible",l=(d=document.getElementById("_cvc")).getBoundingClientRect(),v[d.name]&&v[d.name].options&&v[d.name].options.style&&v[d.name].options.style.cvvIcon&&"top"===v[d.name].options.style.cvvIcon.tooltipPosition?u.style.top=l.top-e.height+window.pageYOffset+"px":u.style.top=l.bottom+window.pageYOffset+2+"px",v[d.name]&&v[d.name].fieldsOptions&&("rtl"===v[d.name].fieldsOptions.textDirection||"he"===v[d.name].fieldsOptions.locale||"ar"===v[d.name].fieldsOptions.locale)?l.left-e.width/2<0?u.style.left=0:u.style.left=l.left-e.width/2+"px":l.right+e.width/2>document.documentElement.offsetWidth?u.style.left=l.right-e.width+"px":u.style.left=l.right-10-e.width/2+"px",e.width>=document.documentElement.offsetWidth&&(u.style.width=document.documentElement.offsetWidth-60+"px")):(u.style.visibility=m.visibility,l=(d=document.getElementById("one-field")).getBoundingClientRect(),v[d.name]&&v[d.name].options&&v[d.name].options.style&&v[d.name].options.style.cvvIcon&&"top"===v[d.name].options.style.cvvIcon.tooltipPosition?u.style.top=l.top-e.height+window.pageYOffset+"px":u.style.top=l.bottom+2+window.pageYOffset+"px",v[d.name]&&v[d.name].fieldsOptions&&("rtl"===v[d.name].fieldsOptions.textDirection||"he"===v[d.name].fieldsOptions.locale||"ar"===v[d.name].fieldsOptions.locale)?l.left-e.width/2<0?u.style.left=0:u.style.left=l.left-e.width/2+m.inputWrapperRect.width/4+"px":l.right+e.width/2>document.documentElement.offsetWidth?u.style.left=l.right-e.width+"px":u.style.left=m.inputWrapperRect.right-e.width/2-20+"px",e.width>document.documentElement.offsetWidth&&(u.style.width=document.documentElement.offsetWidth-10+"px"))}y&&"tokenize-result"===p.event&&(g.info("---\x3e "+p.event+"\n"+JSON.stringify(p,null,4)),g.trace("---\x3e "+p.event+"\n"),t=p.message.payload.data,N(),t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.v2supported&&"true"===t.paymentOption.card.threeD.v2supported?(u=t.paymentOption.card.threeD,t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},u.methodUrl||(t.paymentOption.card.threeD.methodCompletionInd="U",y(t)),u.methodUrl&&u.methodPayload&&j(u.methodUrl,u.methodPayload,function(e){t.paymentOption.card.threeD.methodCompletionInd=e,y(t)})):y(p.message.payload.data)),"init-payment-threeDVersion"===p.event&&(g.info("---\x3e "+p.event+"\n"+JSON.stringify(p,null,4)),g.trace("---\x3e "+p.event+"\n"),O=p.message.payload.data),"onPaymentEvent"===p.event&&(O=p.message.payload.data.threeDVersion,C=p.message.payload.data.v2supported,websdk_core.onPaymentEvent({eventType:"tokenized",threeD:{version:O}},I.onPaymentEvent,k,C,E),"false"===p.message.payload.data.v2supported&&websdk_core.onPaymentEvent({eventType:"3DSupported",threeD:{threeDSupported:"false"}},I.onPaymentEvent,k,C,E)),"dcc-result"===p.event&&y(p.message.payload.data),"sightline-enroll-account-result"===p.event&&h(p.message.payload.data),"card-details-result"===p.event&&(y||f)(p.message.payload.data),"add-card-upo-result"===p.event&&y&&y(p.message.payload.data),f&&"make-payment-result"===p.event&&(g.info("---\x3e "+p.event+"\n"+JSON.stringify(p,null,4)),g.trace("---\x3e "+p.event+"\n"),(o=p.message.payload.data).paymentOption&&o.paymentOption.card&&o.paymentOption.card.threeD&&o.paymentOption.card.threeD.acsUrl&&(o.paymentOption.card.threeD.paRequest||o.paymentOption.card.threeD.cReq)?(o.paymentOption.card.threeD.paRequest&&(o.all.sourceMethod&&"createPayment"===o.all.sourceMethod?o.paymentOption.card.threeD.termUrl=o.all.server+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+o.sessionToken:o.all.sourceMethod&&"authenticate3d"===o.all.sourceMethod&&(o.paymentOption.card.threeD.termUrl=o.all.server+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+o.sessionToken)),k=o.paymentOption.card.threeD.acsUrl,websdk_core.onPaymentEvent({eventType:"paymentStarted",threeD:{version:o.paymentOption.card.threeD.version||"",flow:"challenge"}},I.onPaymentEvent,k,C,E),q(o,function(e){f(e)})):(n=void 0===o.error?{}:o.error,o.paymentOption=o.paymentOption||{},o.paymentOption.card=o.paymentOption.card||{},o.paymentOption.card.threeD=o.paymentOption.card.threeD||{},o.errorDescription!==A&&websdk_core.onPaymentEvent({eventType:"paymentStarted",threeD:{version:o.paymentOption.card.threeD.version||"",flow:""}},I.onPaymentEvent,k,C,E),r={result:o.transactionStatus||o.status||"ERROR",errCode:o.gwExtendedErrorCode||o.gwErrorCode||o.paymentMethodErrorCode||o.errorCode||n.code||o.errCode||"0",errorDescription:o.gwErrorReason||o.paymentMethodErrorReason||o.errorDescription||o.message||n.message||"",userPaymentOptionId:o.paymentOption.userPaymentOptionId||"",cavv:o.paymentOption.card.threeD.cavv||"",eci:o.paymentOption.card.threeD.eci||"",xid:o.paymentOption.card.threeD.xid||"",dsTransID:o.paymentOption.card.threeD.dsTransID||"",ccCardNumber:o.paymentOption.card.ccCardNumber||"",bin:o.paymentOption.card.bin||"",last4Digits:o.paymentOption.card.last4Digits||"",ccExpMonth:o.paymentOption.card.ccExpMonth||"",ccExpYear:o.paymentOption.card.ccExpYear||"",transactionId:o.transactionId,mcc:o.mcc||"",cancelled:!1,transactionStatus:o.transactionStatus,transactionType:o.transactionType},o.all&&"authenticate3d"===o.all.sourceMethod&&(r.ccTempToken=o.ccTempToken),o.partialApproval&&"createPayment"===o.all.sourceMethod&&(r.partialApproval=o.partialApproval),f(r))),"change"===p.event&&v[p.source]&&(i=v[p.source].stateClass.focus,n=v[p.source].stateClass.empty,o=v[p.source].stateClass.complete,r=v[p.source].stateClass.optional,v[p.source].parentElm.classList.remove(r),p.message.payload.empty?(v[p.source].parentElm.classList.add(n),(v[p.source].options.optional||p.message.payload.optional)&&v[p.source].parentElm.classList.add(r)):(v[p.source].parentElm.classList.remove(n),v[p.source].parentElm.classList.remove(r)),p.message.payload.complete?v[p.source].parentElm.classList.add(o):v[p.source].parentElm.classList.remove(o),p.message.payload&&p.message.payload.cardType&&"unknown"!==p.message.payload.cardType&&(T=p.message.payload),a=[],"ccCvc"!==v[p.source].field&&"ccExpiration"!==v[p.source].field||Object.keys(v).forEach(function(e){"ccNumber"!==v[e].field||v[e].peers.ccCvc!==p.source&&v[e].peers.ccExpiration!==p.source||((D=[]).push(v[e].uuid),v[e].peers.ccCvc&&D.push(v[e].peers.ccCvc),v[e].peers.ccExpiration&&D.push(v[e].peers.ccExpiration))}),"ccNumber"===v[p.source].field&&v[p.source].peers&&(v[p.source].peers.ccCvc||v[p.source].peers.ccExpiration)&&((D=[]).push(p.source),v[p.source].peers.ccCvc&&D.push(v[p.source].peers.ccCvc),v[p.source].peers.ccExpiration&&D.push(v[p.source].peers.ccExpiration)),D.includes(v[p.source].uuid)&&(D.forEach(function(e){a.push(v[e].parentElm.classList.contains("sfc-complete"))}),a.includes(!1)||0===a.length?p.message.payload.allFieldsCompleted=!1:p.message.payload.allFieldsCompleted=!0),B("change",v[p.source].subs,Object.assign({field:v[p.source].field},p.message.payload))),"focus"===p.event&&v[p.source]&&(i=v[p.source].stateClass.focus,v[p.source].parentElm.classList.add(i),B(p.event,v[p.source].subs,{field:v[p.source].field})),"paste"===p.event&&v[p.source]&&B(p.event,v[p.source].subs,{field:v[p.source].field}),"blur"===p.event&&v[p.source]&&(i=v[p.source].stateClass.focus,v[p.source].parentElm.classList.remove(i),B(p.event,v[p.source].subs,{field:v[p.source].field,fieldData:p.fieldData,optional:p.optional,complete:p.complete})),"load"===p.event&&v[p.source]&&v[p.source]._init(),"ready"===p.event&&(v[p.source]&&("_card"===v[p.source]._type&&p.message.payload.support19Digits,p.message.payload.data&&p.message.payload.data.style&&p.message.payload.data.style.base&&p.message.payload.data.style.base.fieldSize?v[p.source].frameElm.style.height=p.message.payload.data.style.base.fieldSize:0!==p.message.payload.height?v[p.source].frameElm.style.height=p.message.payload.height+"px":p.message.payload.data&&p.message.payload.data.style&&p.message.payload.data.style.base&&p.message.payload.data.style.base.fontSize?(i=p.message.payload.data.style.base.fontSize.match(/(\d+)/)).length&&(i=parseInt(i[0])+3,v[p.source].frameElm.style.height=i+"px"):v[p.source].frameElm.style.height="1rem",v[p.source].sendPeers()),B(p.event,v[p.source].subs,{field:v[p.source].field})),"keydown"===p.event&&v[p.source]&&B(p.event,v[p.source].subs,{field:v[p.source].field,keyCode:p.keyCode}),"enterXhrActionGetToken"===p.event&&(s=M("GetToken_started/GetToken_complete"),window.getTokenDo=s),"leaveXhrActionGetToken"===p.event&&U(window.getTokenDo),"enterXhrActionInit"===p.event&&(s=M("initPayment_started/initPayment_complete"),window.actionIdInit=s),"leaveXhrActionInit"===p.event&&U(window.actionIdInit),"enterXhrActionPayment"===p.event&&(c=M("clientPayment_started/clientPayment_complete"),window.actionIdPayment=c),"leaveXhrActionPayment"===p.event&&U(window.actionIdPayment),"enterXhrActionAuth"===p.event&&(c=M("clientAuthorize3d_started/clientAuthorize3d_complete"),window.requestAuthAction=c),"leaveXhrActionAuth"===p.event&&U(window.requestAuthAction)}function S(e){var t;e.hasOwnProperty("cardNumber")&&(t=e||{}).status&&"OK"===t.status&&(function(e){for(var t in v)v[t].frameElm&&("ccNumber"===v[t].field&&v[t].setValue(e.cardNumber),"ccExpiration"===v[t].field&&v[t].setValue(e.expDate),"card"===v[t].field&&v[t].setValue(e))}(t),"function"==typeof I.onPostScanCardEvent&&(t.hasCardNumber=t.cardNumber&&"null"!==t.cardNumber,t.hasExpDate=t.expDate&&"null"!==t.expDate,delete t.cardNumber,delete t.expDate,delete t.cvv,I.onPostScanCardEvent(t)))}function B(e,t,n){t[e]&&t[e].forEach(function(e){e.call(n,n)})}function J(e,t,n){this.field=e.field,e.type&&(e.type="_"+e.type),e.targetHost={local:"https://dev-mobile.safecharge.com",test:"https://cdn-int.safecharge.com",prod:"https://cdn.safecharge.com",live:"https://cdn.safecharge.com",tag:"https://srv-bsf-devppptag.gw-4u.com"}[e.env||"prod"],this._type=e.type||"",this.options=e,this.fieldsOptions=n,this.uuid=t,this.subs={},this.frameElm=null,this.initialParentClasses="",this._state={destroyed:!1},this.stateClass={focus:"sfc-focus",empty:"sfc-empty",invalid:"sfc-invalid",complete:"sfc-complete",optional:"sfc-optional"},this.options.classes&&Object.assign(this.stateClass,this.options.classes),this.peers={}}function W(e){this.config=e,this.config.faction=UUIDjs.create().toString(),this.instances=[]}function F(){document.getElementsByName(this.nuveiIframeName)[0].remove(),document.getElementById(i).remove()}window.addEventListener("message",w,!1),window.addEventListener("popstate",function(){var e={},t=document.location.hash.substring(1);if(t)try{e=JSON.parse(atob(t))}catch(e){}S(e)},!1),J.prototype._sendMsg=function(e){e.type="td",e.source=this.uuid;var t=document.createElement("A");t.href=websdk_core.findSfcHost(),e.origin=document.location.origin;t=t.protocol+"//"+t.host;this.frameElm.contentWindow&&this.frameElm.contentWindow.postMessage(JSON.stringify(e),t)},J.prototype.sendPeers=function(){this._sendMsg({action:"add-member",payload:this.peers,origin:document.location.origin})},J.prototype._check=function(){if(this._state.destroyed)throw"The element has already been destroyed"},J.prototype._init=function(){this._check(),this._sendMsg({action:"init-field",support19Digits:t,payload:this.options,fieldsConfig:this.fieldsOptions,origin:document.location.origin,merchantDetails:I})},J.prototype.addMember=function(e){this.peers[e.type]=e.id},J.prototype.setValue=function(e){this._check(),this._sendMsg({action:"input-value",value:e})},J.prototype.focus=function(){this._check(),this._sendMsg({action:"input-focus",source:this.uuid})},J.prototype.clear=function(){this._check(),this._sendMsg({action:"input-clear",source:this.uuid})},J.prototype.__tokenize=function(e,t,n){y=n,this._check(),this._sendMsg({extraData:t,action:"input-tokenize",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,env:e.env,all:e})},J.prototype.__getDCC=function(e,t,n){y=n,t.cardNumber={},this._check(),this._sendMsg({extraData:t,action:"get-dcc",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env})},J.prototype.__enrollSightlineAccount=function(e,t,n){h=n,this._check(),this._sendMsg({extraData:t,action:"enroll-sightline-account",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env})},J.prototype.__getCardDetails=function(e,t,n){y=n,this._check(),this._sendMsg({extraData:t,action:"get-card-details",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env})},J.prototype.__addCardUpo=function(e,t,n){y=n,this._check(),delete t.cardNumber,this._sendMsg({extraData:t||{},action:"add-card-upo",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env,all:e})},J.prototype.__makePayment=function(e,t,n){var o,r,a;f=n,t.paymentOption.userPaymentOptionId?(o=t.paymentOption.userPaymentOptionId,r=t.paymentOption.card.expirationMonth,a=t.paymentOption.card.expirationYear,n=t.paymentOption.card.selectedBrand,t.paymentOption={},t.paymentOption.card={},t.paymentOption.userPaymentOptionId=o,t.paymentOption.card.expirationMonth=r,t.paymentOption.card.expirationYear=a,t.paymentOption.card.selectedBrand=n):t.paymentOption={},this._check(),this._sendMsg({extraData:t,action:"input-make-payment",sessionToken:e.sessionToken||t.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env,all:e})},J.prototype.destroy=function(){this._check(),this._state.destroyed=!0,this.parentElm.innerHTML="",this.parentElm.className=this.initialParentClasses},J.prototype.attach=function(e){"string"==typeof e&&(e=document.querySelector(e));var t=this;(this.parentElm=e).addEventListener("click",function(){t.focus()});for(var n,o=e.nextElementSibling;o;)"LABEL"===o.tagName&&o.addEventListener("click",function(){!1===t._state.destroyed&&t.focus()}),o=o.nextElementSibling;this.initialParentClasses=e.classList.value,e.classList.add("SfcField"),e.classList.add(this.stateClass.empty),this.options.optional&&e.classList.add(this.stateClass.optional),!this.options.cvvIcon||"_cvc"!==this.options.type&&""!==this._type||document.getElementById("toolTipMsg")||(a=document.createElement("div"),n="The 3 digit secure code on the back of your card",this.fieldsOptions&&this.fieldsOptions.i18n&&this.fieldsOptions.i18n.cvv_tooltip&&(n=this.fieldsOptions.i18n.cvv_tooltip),r={position:"absolute",visibility:"hidden",maxWidth:"100%",minWidth:"150px",backgroundColor:"black",color:"#fff",fontSize:"12px",textAlign:"center",borderRadius:"6px",padding:"5px 10px",zIndex:1,top:0,left:0,float:"left",clear:"left"},r=objectToCSS(r=this.options&&this.options.style&&this.options.style.tooltip?Object.assign(r,this.options.style.tooltip):r),a.setAttribute("id","toolTipMsg"),"rtl"===this.fieldsOptions.textDirection&&a.setAttribute("dir","rtl"),a.textContent=n,document.body.appendChild(a),document.head.insertAdjacentHTML("beforeend","<style> #toolTipMsg {"+r+"} </style>"),this.options.tooltipRect=a.getBoundingClientRect());var r=document.createElement("div");r.setAttribute("style","margin:0 !important; padding:0 !important;border:none !important;display:block !important;background:transparent !important;position:relative !important;opacity:1 !important;");var a=document.createElement("iframe");a.frameborder="0",a.allowtransparency="true",a.scrolling="no",a.name=this.uuid,a.allowpaymentrequest="true",a.src=websdk_core.findSfcHost()+"sfc_inner"+this._type+".html?v1.141.0",a.title="SFC secure field",e.appendChild(r),a.setAttribute("style","border:none !important;margin:0 !important;padding:0 !important;width:1px !important;min-width:100% !important;overflow:hidden !important;display:block !important;height:0;"),a.setAttribute("id",this._type||"one-field"),a.allow="shared-autofill",this.frameElm=a,r.appendChild(a)},J.prototype.on=function(e,t){-1<["blur","change","focus","ready","paste","keydown"].indexOf(e)&&t&&"function"==typeof t&&(this.subs[e]||(this.subs[e]=[]),this.subs[e].push(t))},W.prototype.create=function(t,e){if("card"!==t&&"ccNumber"!==t&&"ccExpiration"!==t&&"ccCvc"!==t)throw"A valid Element name must be provided. Valid Elements is card\nyou requested: "+t+".";var n=UUIDjs.create().toString();"card"!==t&&(e.type={ccNumber:"card",ccExpiration:"exp",ccCvc:"cvc"}[t]);var o=this.config.alwaysCollectCvv;return"ccCvc"===t&&(e.optional=!0===e.optional||"optional"===o),"ccNumber"!==t&&"card"!==t||(e.cvcIsOptional=!0===e.cvcIsOptional||"optional"===o),e.field=t,e.env=I.env,e.cvvIcon=I.cvvIcon,v[n]=new J(e,n,this.config),this.instances.length&&this.instances.forEach(function(e){e.instance.addMember({type:t,id:n})}),this.instances.push({type:t,instance:v[n]}),v[n]};var V=function(e){var t={};try{t=JSON.parse(e)}catch(e){t={error:{type:"network",code:"invalid response",message:"SafeCharge Server returned invalid response"}}}return t},H=function(e){var t=new RegExp(/^(customField)([1-9]+)*$/),t=e.match(t);if(t){t=t[2];return t&&0<t&&t<16}return!1};e.SafeCharge=function(D){u("identifyUser",D.sessionToken),u("startWebSDKInit",{startTime:Date.now(),requestObject:JSON.stringify(D)}),P={},D=D||{},I.sessionToken=D.sessionToken,I.env=D.env||"prod",I.merchantSiteId=D.merchantSiteId,I.merchantId=D.merchantId,I.sourceApplication=D.sourceApplication,I.logLevel=D.logLevel||0,I.strictCardBlocking=D.strictCardBlocking,I.blockCards=D.blockCards,I.blockPasteCard=D.blockPasteCard,I.useDualBrand=D.useDualBrand,I.cvvIcon=D.cvvIcon||!1,t=D.support19Digits||!1,I.maskCvv=D.maskCvv||!1,I.onPaymentEvent=D.onPaymentEvent||"",I.onPostScanCardEvent=D.onPostScanCardEvent,I.disableNuveiAnalytics=D.disableNuveiAnalytics,I.force3D=D.force3D,g.level=I.logLevel;var w=null,S={prod:"https://secure.safecharge.com",int:"https://ppp-test.safecharge.com",test:"https://ppp-test.safecharge.com",qa:"https://apmtest.gate2shop.com",dev:"https://dev-mobile.safecharge.com",local:"https://dev-mobile.safecharge.com",live:"https://secure.safecharge.com",tag:"https://srv-bsf-devppptag.gw-4u.com"}[I.env]||"https://secure.safecharge.com";I.server=S,I.disableNuveiAnalytics;var e={websdk_version:"v1.141.0",merchantid:I.merchantId||"n/a",merchantsiteid:I.merchantSiteId||"n/a",initobject:JSON.stringify(I)};return I.sessionToken&&(e.sessiontoken=I.sessionToken),u("init webSDK",e),{fields:function(e){return new W(e)},getDirectUPOs:function(){return{apmgw_Secure_Bank_Transfer:!0}},enrollSightlineAccountWithFund:function(e,t){"function"!=typeof t&&(t=function(){});var n,o=[];for(n in v)"ccNumber"===v[n].field&&o.push(v[n]);o.pop().__enrollSightlineAccount(I,e,t)},addApmUpo:function(e,t){if("function"!=typeof t&&(t=function(){}),!e.paymentMethodName)throw new Error("The paymentMethodName property is missing or invalid.");var e={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,clientRequestId:e.clientRequestId||Math.ceil(1e16*Math.random()),paymentMethodName:e.paymentMethodName,apmData:e.apmData,billingAddress:e.billingAddress},n=new XMLHttpRequest;n.open("POST",S+"/ppp/api/v1/clientAddUPOAPM.do",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.timeout=6e4,n.onload=function(){var e;200===n.status?("SUCCESS"===(e={result:(e=V(n.responseText)).status,errCode:e.errCode||"0",errorDescription:e.errorDescription||e.reason||"",userPaymentOptionId:e.userPaymentOptionId||"",cancelled:e.cancelled||!1}).result&&(e.result="ADDED"),t(e)):t(V(n.responseText))},n.ontimeout=function(){t({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},n.onabort=function(){t({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},n.onerror=function(){t({error:{status:"ERROR",type:"network",code:"connection_lost",message:_}})},n.send(JSON.stringify(e))},addCardUpo:function(o,r){if("function"!=typeof r&&(r=function(){}),o.cardNumber&&o.cardNumber.__addCardUpo)o.cardNumber.__addCardUpo(I,o,r);else if(!0===o.useFields){var e,t=[];for(e in v)"ccNumber"!==v[e].field&&"card"!==v[e].field||t.push(v[e]);t.pop().__addCardUpo(I,o,r)}else{if(!o.cardNumber)throw new Error("The cardNumber property is missing or invalid.");if(!o.expMonth)throw new Error("The expMonth property is missing or invalid.");if(!o.expYear)throw new Error("The expYear property is missing or invalid.");function n(){var e={sessionToken:I.sessionToken||o.sessionToken,merchantSiteId:I.merchantSiteId||o.merchantSiteId,merchantId:I.merchantId||o.merchantId,clientRequestId:o.clientRequestId||Math.ceil(1e16*Math.random()),ccCardNumber:o.cardNumber,ccExpMonth:o.expMonth,ccExpYear:o.expYear,ccNameOnCard:o.cardHolderName,billingAddress:o.billingAddress},n=new XMLHttpRequest;n.open("POST",S+"/ppp/api/v1/clientAddUPOCreditCard.do",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.timeout=6e4,n.onload=function(){var e,t;200===n.status?("SUCCESS"===(t={result:(e=V(n.responseText)).status,errCode:e.errCode||"0",errorDescription:e.errorDescription||e.reason||"",userPaymentOptionId:e.userPaymentOptionId||"",ccCardNumber:"",bin:e.bin||"",last4Digits:e.last4Digits||"",ccExpMonth:o.expMonth,ccExpYear:o.expYear,cancelled:e.cancelled||!1}).result&&(t.result="ADDED"),e.last4Digits&&(t.ccCardNumber=`${o.cardNumber[0]}****${e.last4Digits}`),r(t)):r(V(n.responseText))},n.ontimeout=function(){r({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},n.onabort=function(){r({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},n.onerror=function(){r({error:{status:"ERROR",type:"network",code:"connection_lost",message:_}})},n.send(JSON.stringify(e))}I.blockCards&&0<I.blockCards.length?this.getCardDetails({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,cardNumber:o.cardNumber},function(e){if("ERROR"===e.status||e.error&&"ERROR"===e.error.status){if(!0===I.strictCardBlocking)return void r({result:"ERROR",errCode:e.errCode||"0",errorDescription:e.errorDescription||e.reason||e.error&&e.error.message||""})}else if(x(I.blockCards,e))return void r({result:"ERROR",errCode:-6,errorDescription:R});n()}):n()}},initSightline:function(e,t,n,o){if(void 0===e)throw"please provide all parameters for initSightline method";if(void 0===t)throw"please provide all parameters for initSightline method";if(void 0===n)throw"please provide all parameters for initSightline method";if(void 0===o)throw"please provide all parameters for initSightline method";var r=websdk_core.findSfcHost()+"fields/sightline.js",a=this;websdk_core.loadScript(r,function(){try{sightlineNuvei.init(e,t,n,I,a,o)}catch(e){}})},createGlobalpayPayment:function(e,t){if("function"!=typeof t&&(t=function(){}),void 0===e||void 0===t)throw"please provide all parameters for createGlobalpayPayment method";void 0!==globalpay.paymentVals?(e.paymentOption={alternativePaymentMethod:{paymentMethod:"apmgw_VIP_Preferred",globalpay_accountId:globalpay.paymentVals.accountNumber,globalpay_bankAccount:globalpay.paymentVals.selectedAccount,globalpay_firstName:globalpay.paymentVals.firstName,globalpay_lastName:globalpay.paymentVals.lastName,globalpay_phone:globalpay.paymentVals.phone}},E="apmgw_VIP_Preferred",this.createPayment(e,t)):this.initGlobalpay(globalpay.placeholder,globalpay.globalpayParams,globalpay.styleObject,globalpay.cb)},createSightlinePayment:function(e,t){E="apmgw_PlayPlus",websdk_core.onPaymentEvent({eventType:"initiated"},I.onPaymentEvent,k,C,E);var n;if(e.paymentOption&&e.paymentOption.userPaymentOptionId)e.paymentOption.alternativePaymentMethod={paymentMethod:"apmgw_PlayPlus"};else if(e.paymentOption={alternativePaymentMethod:{paymentMethod:"apmgw_PlayPlus",sightline_ssn:sightlineNuvei.ssnVal}},sightlineNuvei.checkFields&&sightlineNuvei.checkFields(),!sightlineNuvei.checkSSN||!sightlineNuvei.checkSSN())return void t({status:"ERROR",type:"invalid input field",code:"invalid input field",errorDescription:"invalid SSN"});e.billingAddress&&sightlineNuvei.sightlineParams.billingAddress&&(n=JSON.parse(JSON.stringify(e.billingAddress)),e.billingAddress=Object.assign(n,sightlineNuvei.sightlineParams.billingAddress)),e.userDetails&&sightlineNuvei.sightlineParams.userDetails&&(n=JSON.parse(JSON.stringify(e.userDetails)),e.userDetails=Object.assign(n,sightlineNuvei.sightlineParams.userDetails)),function(e,n){e.hasOwnProperty("useDCC")&&(e.useDcc=e.useDCC,delete e.useDCC),e.hasOwnProperty("savePM")&&(e.paymentOption.savePm=e.savePM,delete e.savePM);var o=new XMLHttpRequest;o.open("POST",S+"/ppp/api/v1/clientPayment.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){n({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},o.ontimeout=function(){return n({error:{type:"network",code:"connection_timeout",message:_}})},o.onload=function(){var e,t;200===o.status?(websdk_core.onPaymentEvent({eventType:"paymentStarted"},I.onPaymentEvent,k,C,E),U(window.clintPaymentDoId),void 0===(e=V(o.responseText)).all&&(e.all={}),e.all.sourceMethod="createPayment",e.all.server=S,"ERROR"===e.status?n(e):"SUCCESS"===e.status&&(e.paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},t={result:e.transactionStatus,errCode:e.gwExtendedErrorCode||e.gwErrorCode||e.paymentMethodErrorCode||e.errorCode||"0",errorDescription:e.gwErrorReason||e.paymentMethodErrorReason||e.errorDescription||"",userPaymentOptionId:e.paymentOption.userPaymentOptionId,ccCardNumber:e.paymentOption.card.ccCardNumber,bin:e.paymentOption.card.bin,last4Digits:e.paymentOption.card.last4Digits||"",ccExpMonth:e.paymentOption.card.ccExpMonth||"",ccExpYear:e.paymentOption.card.ccExpYear||"",transactionId:e.transactionId,mcc:e.mcc||"",cancelled:!1},e.partialApproval&&(t.partialApproval=e.partialApproval),n(t))):n(fixIncorrectResult(o.responseText))},e.sourceApplication=I.sourceApplication||"WEB_SDK";var t=M("payment_started/payment_complete");window.clintPaymentDoId=t,o.send(JSON.stringify(e))}(e,t)},initGlobalpay:function(e,t,n,o){if(void 0===e)throw"please provide all parameters for initGlobalpay method";if(void 0===t)throw"please provide all parameters for initGlobalpay method";if(void 0===n)throw"please provide all parameters for initGlobalpay method";if(void 0===o)throw"please provide all parameters for initGlobalpay method";var r=websdk_core.findSfcHost()+"fields/globalPay.js";websdk_core.loadScript(r,function(){try{globalpay.init(e,t,n,I,o)}catch(e){}})},enrollAccount:function(e,t){"function"!=typeof t&&(t=function(){}),sightline.sightlineEnrollAccount(S,e,t)},authenticate3d:function(r,a){var i,s;function t(){if(r.openAmount&&delete r.openAmount,r.paymentOption.card,g.trace("---\x3e TRACE authenticate3d \n"),!r.merchantSiteId&&I.merchantSiteId&&(r.merchantSiteId=I.merchantSiteId),!r.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!r.merchantId&&I.merchantId&&(r.merchantId=I.merchantId),!r.merchantId)throw new Error("Merchant id is mandatory.");function n(e,n){var o;e.ccTempToken&&(o=e.ccTempToken,delete e.ccTempToken),e.useDCC&&(e.useDcc=e.useDCC,delete e.useDCC),e.hasOwnProperty("savePM")&&(e.paymentOption.savePm=e.savePM,delete e.savePM);var r=M("verify3d_started/verify3d_complete"),a=new XMLHttpRequest;a.open("POST",S+"/ppp/api/v1/clientAuthorize3d.do",!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.timeout=6e4,a.onerror=function(){U(r),n({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},a.ontimeout=function(){return U(r),n({error:{type:"network",code:"connection_timeout",message:_}})},a.onload=function(){var e,t;200===a.status?(U(r),void 0===(e=V(a.responseText)).all&&(e.all={}),e.all.sourceMethod="authenticate3d",e.all.server=S,"ERROR"===e.status?(e.error={type:"card",code:e.errCode},e.error.message=e.reason||"Process failed.",n(s(e))):"SUCCESS"===e.status&&(e.ccTempToken=o,e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&e.paymentOption.card.threeD.acsUrl&&(e.paymentOption.card.threeD.paRequest||e.paymentOption.card.threeD.cReq)?(e.paymentOption.card.threeD.paRequest&&(e.paymentOption.card.threeD.termUrl=S+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+e.sessionToken),k=e.paymentOption.card.threeD.acsUrl,websdk_core.onPaymentEvent({eventType:"paymentStarted",threeD:{version:e.paymentOption.card.threeD.version||"",flow:"challenge"}},I.onPaymentEvent,k,C,E),i.paymentFrame(e,function(e){"undefined"!=typeof tempData&&tempData.paymentOption&&tempData.paymentOption.card&&tempData.paymentOption.card.threeD&&tempData.paymentOption.card.threeD.version&&(e.threeDVersion=tempData.paymentOption.card.threeD.version||"",delete window.tempData),n(s(e))})):(e.paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},e.paymentOption.card.threeD=e.paymentOption.card.threeD||{},websdk_core.onPaymentEvent({eventType:"paymentStarted",threeD:{version:e.paymentOption.card.threeD.version||"",flow:""}},I.onPaymentEvent,k,C,E),t={result:e.transactionStatus,errCode:e.gwExtendedErrorCode||e.gwErrorCode||e.paymentMethodErrorCode||e.errorCode||"0",errorDescription:e.gwErrorReason||e.paymentMethodErrorReason||e.errorDescription||"",userPaymentOptionId:e.paymentOption.userPaymentOptionId||"",cavv:e.paymentOption.card.threeD.cavv||"",eci:e.paymentOption.card.threeD.eci||"",xid:e.paymentOption.card.threeD.xid||"",dsTransID:e.paymentOption.card.threeD.dsTransID||"",ccCardNumber:e.paymentOption.card.ccCardNumber||"",bin:e.paymentOption.card.bin||"",last4Digits:e.paymentOption.card.last4Digits||"",ccExpMonth:e.paymentOption.card.ccExpMonth||"",ccExpYear:e.paymentOption.card.ccExpYear||"",threeDVersion:e.paymentOption.card.threeD.version||"",transactionId:e.transactionId,mcc:e.mcc||"",cancelled:!1},e.all&&"authenticate3d"===e.all.sourceMethod&&(t.ccTempToken=e.ccTempToken),n(s(t))))):n(s(a.responseText))},e.sourceApplication=I.sourceApplication||"WEB_SDK",a.send(JSON.stringify(e))}var e=!1;try{e=navigator.javaEnabled()}catch(e){}var t,o={acceptHeader:"Y",userAgent:navigator.userAgent,javaEnabled:e,language:navigator.language,colorDepth:screen.colorDepth,screenHeight:screen.height,screenWidth:screen.width,timeZone:(new Date).getTimezoneOffset(),javaScriptEnabled:!0};I.sourceMethod="authenticate3d",r.paymentOption&&r.paymentOption.__makePayment?(T&&(r._validationState=T),r.browserDetails=o,r.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",r.paymentOption.__makePayment(I,r,function(e){e.threeDVersion=O,a(s(e))})):r.paymentOption&&r.paymentOption.userPaymentOptionId&&r.paymentOption.card&&r.paymentOption.card.CVV&&r.paymentOption.card.CVV.__makePayment?(T&&(r._validationState=T),r.browserDetails=o,r.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",r.paymentOption.card.CVV.__makePayment(I,r,function(e){a(s(e))})):(r.sourceApplication=I.sourceApplication||"WEB_SDK",(t=JSON.parse(JSON.stringify(r))).paymentOption=t.paymentOption||{},t.paymentOption.useInitPayment=!0,delete t.shippingAddress,delete t.userDetails,delete t.useDCC,delete t.savePM,delete t.clientRequestId,I.blockCards&&0<I.blockCards.length&&t.paymentOption.card&&t.paymentOption.card.cardNumber?i.getCardDetails({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,cardNumber:t.paymentOption.card.cardNumber},function(e){if("ERROR"===e.status||e.error&&"ERROR"===e.error.status){if(!0===I.strictCardBlocking)return void a(s({result:"ERROR",errCode:e.errCode||"0",errorDescription:e.errorDescription||e.reason||e.error&&e.error.message||""}))}else if(x(I.blockCards,e))return void a(s({errCode:-6,result:"ERROR",errDescription:R}));i.initPayment(t,function(e){r.paymentOption=r.paymentOption||{},window.tempData=e;var t=JSON.parse(JSON.stringify(r));t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},e.paymentOption&&(t.ccTempToken=e.paymentOption.card.ccTempToken),delete t.currency,delete t.amount;e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=o,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02",t.paymentOption.card.threeD.isDynamic3D=0,"true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=S+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+r.sessionToken),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd),t.paymentOption.card.threeD.version),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported&&(websdk_core.onPaymentEvent({eventType:"3DSupported",threeD:{threeDSupported:"false"}},I.onPaymentEvent,k,C,E),delete t.paymentOption.card.threeD),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"true"===e.paymentOption.card.threeD.v2supported?n(t,a):a(s({errorDescription:A}))})}):i.initPayment(t,function(e){r.paymentOption=r.paymentOption||{},window.tempData=e;var t=JSON.parse(JSON.stringify(r));t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},e.paymentOption&&(t.ccTempToken=e.paymentOption.card.ccTempToken),delete t.currency,delete t.amount;e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=o,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02",t.paymentOption.card.threeD.isDynamic3D=0,"true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=S+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+r.sessionToken),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd),t.paymentOption.card.threeD.version),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported&&(delete t.paymentOption.card.threeD,websdk_core.onPaymentEvent({eventType:"3DSupported",threeD:{threeDSupported:"false"}},I.onPaymentEvent,k,C,E)),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"true"===e.paymentOption.card.threeD.v2supported?n(t,a):a(s({errorDescription:A}))}))}"function"!=typeof a&&(a=function(){}),!0!==P.isProcessing?(P.isProcessing=!0,E=n(r),websdk_core.onPaymentEvent({eventType:"initiated"},I.onPaymentEvent,k,C,E),r.paymentOption.peers?r.paymentOption.peers.ccCvc?callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_THREE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_ONE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_NOFIELDS"},null]),r.billingAddress&&r.billingAddress.email?(callDtrum("sendSessionProperties",[null,null,{usertokenid:r.billingAddress.email},null]),u("identifyUser",r.billingAddress.email+" / "+I.merchantId)):u("identifyUser",UUIDjs.create().hex.split("-")[0]+" / "+I.merchantId),r.sessionToken&&callDtrum("sendSessionProperties",[null,null,{sessiontoken:r.sessionToken},null]),i=this,s=function(e){return m(),N(),P={},e},r.openAmount?this.setOpenAmount({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,amount:r.openAmount,currency:r.currency,clientRequestId:r.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:r.clientUniqueId},function(e){"ERROR"===e.status?a(s(e)):t()}):t()):a({processingOrder:!0})},getApms:function(e,t){g.info("---\x3e sfc.getAmps() input object---------------------- \n"+JSON.stringify(e,null,4)),g.trace("---\x3e sfc.getAmps() stack trace---------------------- \n"),"function"!=typeof t&&(t=function(){});var n=M("getApms"),o=new XMLHttpRequest;o.open("POST",S+"/ppp/api/v1/getMerchantPaymentMethods.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){U(n),t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},o.ontimeout=function(){return U(n),t({error:{type:"network",code:"connection_timeout",message:_}})},o.onload=function(){U(n),200===o.status?t(V(o.responseText)):t(o.responseText)};var r={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,timeStamp:(new Date).getTime(),clientRequestId:e.clientRequestId||Math.ceil(1e16*Math.random())};r.type=e.type||"DEPOSIT",e.currencyCode&&(r.currencyCode=e.currencyCode),e.countryCode&&(r.countryCode=e.countryCode),e.ipAddress&&(r.ipAddress=e.ipAddress),r.languageCode=e.languageCode||"en",o.send(JSON.stringify(r))},getUserUPOs:function(e){"function"!=typeof e&&(e=function(){});var t=M("getUserUPOs"),n=new XMLHttpRequest;n.open("POST",S+"/ppp/api/v1/websdk/clientGetUserUPOs.do",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.timeout=6e4,n.onerror=function(){U(t),e({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},n.ontimeout=function(){return U(t),e({error:{type:"network",code:"connection_timeout",message:_}})},n.onload=function(){U(t),200===n.status?e(V(n.responseText)):e(n.responseText)};var o={sessionToken:I.sessionToken,merchantSiteId:I.merchantSiteId,merchantId:I.merchantId,clientRequestId:Math.ceil(1e16*Math.random())};n.send(JSON.stringify(o))},clientGetDccDetails:function(e,t){if("function"!=typeof t&&(t=function(){}),e.cardNumber&&e.cardNumber.__getDCC)e.cardNumber.__getDCC(I,e,t);else if(!0===e.useFields){var n,o=[];for(n in v)"ccNumber"===v[n].field&&o.push(v[n]);o.pop().__getDCC(I,e,t)}else{var r=new XMLHttpRequest;r.open("POST",S+"/ppp/api/v1/websdk/clientGetDccDetails.do",!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.timeout=6e4,r.onerror=function(){t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},r.ontimeout=function(){return t({error:{type:"network",code:"connection_timeout",message:_}})},r.onload=function(){200===r.status?t(V(r.responseText)):t(r.responseText)};var a={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,clientRequestId:e.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:e.clientUniqueId,currency:e.currency,country:e.country};e.cardNumber?a.cardNumber=e.cardNumber:e.userPaymentOptionId?a.userPaymentOptionId=e.userPaymentOptionId:a.apm=e.apm,r.send(JSON.stringify(a))}},getCardDetails:function(e,t){if("function"!=typeof t&&(t=function(){}),e.cardNumber&&e.cardNumber.__getCardDetails)e.cardNumber.__getCardDetails(I,e,t);else if(!0===e.useFields){var n,o=[];for(n in v)"ccNumber"===v[n].field&&o.push(v[n]);o.pop().__getCardDetails(I,e,t)}else{var r=new XMLHttpRequest;r.open("POST",S+"/ppp/api/v1/getCardDetails.do",!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.timeout=6e4,r.onerror=function(){t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_}),L({errorDescription:_})},r.ontimeout=function(){return L({errorDescription:_}),t({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},r.onload=function(){var e=V(r.responseText);t(e),L(e)};var a={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,clientRequestId:e.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:e.clientUniqueId};e.userPaymentOptionId&&(a.userPaymentOptionId=e.userPaymentOptionId),e.cardNumber&&(a.cardNumber=e.cardNumber),r.send(JSON.stringify(a))}},accountCapture:function(e,t){"function"!=typeof t&&(t=function(){});var n=null;!0===D.showAccountCapture&&(window.skipGetPayoutStatus=!0,n=openWindow(D.sessionToken,S,t));var o=new XMLHttpRequest;o.open("POST",S+"/ppp/api/v1/accountCapture.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){n&&n.close(),t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},o.ontimeout=function(){return n&&n.close(),t({error:{type:"network",code:"connection_timeout",message:_}})},o.onload=function(){var e;200===o.status?((e=V(o.responseText)).openInExternalBrowser&&"true"===e.openInExternalBrowser&&e.redirectUrl&&(e.redirectUrl=S+"/ppp/forwarder.html?open_in_browser=true&link="+encodeURIComponent(e.redirectUrl)),!0===D.showAccountCapture?e.redirectUrl?(n.location=e.redirectUrl,t(e)):n&&(n.close(),t(e)):(n&&n.close(),t(e))):(n&&n.close(),t(o.responseText))};var r={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,amount:e.amount,paymentMethod:e.paymentMethod,userTokenId:e.userTokenId,countryCode:e.countryCode,currencyCode:e.currencyCode,languageCode:e.languageCode,notificationUrl:e.notificationUrl,sourceApplication:e.sourceApplication,userDetails:e.userDetails,urlDetails:e.urlDetails,deviceDetails:e.deviceDetails},a="https://cdn.safecharge.com/safecharge_resources/v1/websdk/autoclose.html";!0!==D.showAccountCapture||e.urlDetails||(r.urlDetails={successUrl:a,failureUrl:a,pendingUrl:a}),o.send(JSON.stringify(r))},buildApplePaySession:function(e,t,n){if(!e.merchantSiteId&&e.merchantSiteId&&(e.merchantSiteId=I.merchantSiteId),!e.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!e.merchantId&&I.merchantId&&(e.merchantId=I.merchantId),!e.merchantId)throw new Error("Merchant id is mandatory.");if(!e.env&&I.env&&(e.env=I.env),!e.env)throw new Error("env is mandatory.");e={merchantSiteId:e.merchantSiteId,server:S,merchantCapabilities:e.merchantCapabilities||null,collectUserDetails:"true"===e.collectUserDetails?"true":"false",supportedNetworks:e.supportedNetworks,countryCode:e.countryCode,currencyCode:e.currencyCode,total:{label:e.total.label,amount:e.total.amount}};(new applePay).buildSession(e,t,n).begin()},createApplePayPaymentWithoutBuildSession:function(e,t){"function"!=typeof t&&(t=function(){}),b=e.completion,"true"!==e.collectUserDetails&&delete e.shippingAndBillingDetails,this.createPayment({sessionToken:e.sessionToken||I.sessionToken,merchantId:e.merchantId||I.merchantId,merchantSiteId:e.merchantSiteId||I.merchantSiteId,userId:e.userId,amount:e.amount,currency:e.currency||e.currencyCode,useDcc:e.useDCC,paymentOption:e.paymentOption,billingAddress:e.shippingAndBillingDetails||e.billingAddress,userDetails:e.userDetails,shippingAddress:e.shippingAndBillingDetails||e.shippingAddress,applePay3Dflow:e.applePay3Dflow},function(e){e.result&&"APPROVED"===e.result?b&&b(!0):b&&b(!1),t(e)})},createGooglePayPayment:function(n,o,r,a){if("function"!=typeof a&&(a=function(){}),!n.sessionToken)throw new Error("payment payload is mandatory.");if(!o.apiVersion)throw new Error("googlePay payload is mandatory.");if(!r.loadPaymentData)throw new Error("google paymentClient is mandatory.");var i,s,e;void 0===o.merchantInfo?(i=this,s=new XMLHttpRequest,e=S+"/ppp/api/googlePayMerchantInfoJwt.do?sessionToken="+n.sessionToken,s.open("GET",e),s.timeout=6e4,s.onload=function(){var e,t;200===s.status?(t=(e=V(s.responseText)).merchantInfo,"SUCCESS"===e.status||"prod"!==D.env?(o.merchantInfo=t,r.loadPaymentData(o).then(function(e){e&&e.shippingAddress&&(n.shippingAddress=mapGooglePayShippingAddress(e.shippingAddress)),e&&e.paymentMethodData&&e.paymentMethodData.info&&e.paymentMethodData.info.billingAddress&&(n.billingAddress=mapGooglePaybillingAddress(e.paymentMethodData.info.billingAddress)),n.paymentOption={card:{externalToken:{externalTokenProvider:"GooglePay",mobileToken:JSON.stringify(e.paymentMethodData)}}},i.createPayment(n,a)}).catch(function(){a({cancelled:!0})})):a(e)):a(V(s.responseText))},s.ontimeout=function(){cb({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},s.onabort=function(){cb({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},s.onerror=function(){cb({error:{status:"ERROR",type:"network",code:"connection_lost",message:_}})},s.send()):r.loadPaymentData(o).then(function(e){e&&e.shippingAddress&&(n.shippingAddress=mapGooglePayShippingAddress(e.shippingAddress)),e&&e.paymentMethodData&&e.paymentMethodData.info&&e.paymentMethodData.info.billingAddress&&(n.billingAddress=mapGooglePaybillingAddress(e.paymentMethodData.info.billingAddress)),n.paymentOption={card:{externalToken:{externalTokenProvider:"GooglePay",mobileToken:JSON.stringify(e.paymentMethodData)}}},i.createPayment(n,a)}).catch(function(){a({cancelled:!0})})},createApplePayPayment:function(n,o){if("function"!=typeof o&&(o=function(){}),!n.merchantSiteId&&n.merchantSiteId&&(n.merchantSiteId=I.merchantSiteId),!n.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!n.merchantId&&I.merchantId&&(n.merchantId=I.merchantId),!n.merchantId)throw new Error("Merchant id is mandatory.");if(!n.env&&I.env&&(n.env=I.env),!n.env)throw new Error("env is mandatory.");var e={merchantSiteId:n.merchantSiteId,server:S,collectUserDetails:"true"===n.collectUserDetails?"true":"false",merchantCapabilities:n.merchantCapabilities||null,supportedNetworks:n.supportedNetworks,countryCode:n.countryCode,currencyCode:n.currencyCode,total:{label:n.total.label,amount:n.total.amount}};E="ppp_ApplePay";var r=this;(new applePay).buildSession(e,function(e,t){b=t,"true"!==n.collectUserDetails&&delete e.shippingAndBillingDetails,r.createPayment({sessionToken:n.sessionToken||I.sessionToken,merchantId:n.merchantId||I.merchantId,merchantSiteId:n.merchantSiteId||I.merchantSiteId,userId:n.userId,amount:n.amount,currency:n.currency||n.currencyCode,useDcc:n.useDCC,billingAddress:e.shippingAndBillingDetails||n.billingAddress,userDetails:n.userDetails,shippingAddress:e.shippingAndBillingDetails||n.shippingAddress,applePay3Dflow:n.applePay3Dflow,paymentOption:{paymentMethod:"ppp_ApplePay",card:{externalToken:{externalTokenProvider:"ApplePay",mobileToken:JSON.stringify(e.token)}}}},function(e){e.result&&"APPROVED"===e.result?b&&b(!0):b&&b(!1),o(e)})},o).begin()},createPayment:function(h,f){"function"!=typeof f&&(f=function(){});var v,g,O=function(e){P={};return h&&h.paymentOption&&h.paymentOption.paymentMethod,e.transactionType&&"auth"!==e.transactionType.toLowerCase()&&"sale"!==e.transactionType.toLowerCase()&&(e.transactionStatus="ERROR",e.errCode="-5",e.gwExtendedErrorCode="-5",e.errorDescription="General 3D error",e.result="ERROR"),m(),N(),e};function t(){if(h.openAmount&&delete h.openAmount,!h.merchantSiteId&&I.merchantSiteId&&(h.merchantSiteId=I.merchantSiteId),!h.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!h.merchantId&&I.merchantId&&(h.merchantId=I.merchantId),!h.merchantId)throw new Error("Merchant id is mandatory.");var e={apmgw_WeBanq:!0,apmgw_Moneta__Direct_Integration_:!0,apmgw_Todito_Cash_Direct_Integration_:!0,apmgw_Webmoney_SMS_Invoice_:!0,entropay:!0,visa_checkout:!0,apmgw_Venmo:!0,apmgw_WeChat_QuickPay:!0,apmgw_AstropayPrePaid:!0,apmgw_AliPay_Barcode:!0,apmgw_BLIK:!0,apmgw_MuchBetter:!0,apmgw_eCheck:!0,apmgw_MBWAY:!0,apmgw_Playtech_Prepaidcard:!0,apmgw_PlayPlus:!0,apmgw_VIP_Preferred:!0,apmgw_ACH:!0,apmgw_Abon:!0,apmgw_OKTO_WALLET:!0},t="pppApmWindow_"+(new Date).getTime(),a=null;window.skipGetPaymentStatus=!1;function n(e,n){var o=e.apmWindowType;e.hasOwnProperty("useDCC")&&(e.useDcc=e.useDCC,delete e.useDCC),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&e.paymentOption.card.externalToken&&("GooglePay"===e.paymentOption.card.externalToken.externalTokenProvider||"ApplePay"===e.paymentOption.card.externalToken.externalTokenProvider)&&(C||(delete e.paymentOption.card.threeD,delete e.relatedTransactionId)),e&&e.paymentOption&&e.paymentOption.alternativePaymentMethod&&e.paymentOption.alternativePaymentMethod.paymentMethod&&"visa_checkout"===e.paymentOption.alternativePaymentMethod.paymentMethod&&delete e.paymentOption.alternativePaymentMethod,e.hasOwnProperty("savePM")&&(e.paymentOption.savePm=e.savePM,delete e.savePM);var r=new XMLHttpRequest;r.open("POST",S+"/ppp/api/v1/clientPayment.do",!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.timeout=6e4,r.onerror=function(){U(window.clintPaymentDoId),g(),a&&a.close(),n(O({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_}))},r.ontimeout=function(){return U(window.clintPaymentDoId),g(),a&&a.close(),n(O({error:{type:"network",code:"connection_timeout",message:_}}))},r.onload=function(){if(U(window.clintPaymentDoId),g(),200===r.status){if(void 0===(t=V(r.responseText)).all&&(t.all={}),t.all.sourceMethod="createPayment",t.all.server=S,"ERROR"===t.status){if(a){if(1058===t.errCode)return P={},a.close(),void n(t);a.close()}t.error={type:"card",code:t.errCode},t.error.message=t.reason||"Process failed.",n(O(t))}else if("SUCCESS"===t.status)if(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.acsUrl&&(t.paymentOption.card.threeD.paRequest||t.paymentOption.card.threeD.cReq))t.paymentOption.card.threeD.paRequest&&(t.paymentOption.card.threeD.termUrl=S+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+t.sessionToken),b&&(b(!0),b=!1),k=t.paymentOption.card.threeD.acsUrl,websdk_core.onPaymentEvent({eventType:"paymentStarted",threeD:{version:t.paymentOption.card.threeD.version||"",flow:"challenge"}},I.onPaymentEvent,k,C,E),v.paymentFrame(t,function(e){n(O(e))});else{var e={eventType:"paymentStarted"};if(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&(e.threeD={version:t.paymentOption.card.threeD.version||"",flow:""},k=t.paymentOption.card.threeD.acsUrl||""),websdk_core.onPaymentEvent(e,I.onPaymentEvent,k,C,E),t.paymentOption=t.paymentOption||{},t.openInExternalBrowser&&"true"===t.openInExternalBrowser&&t.paymentOption&&t.paymentOption.redirectUrl&&(t.paymentOption.redirectUrl=S+"/ppp/forwarder.html?open_in_browser=true&link="+encodeURIComponent(t.paymentOption.redirectUrl)),"REDIRECT"===t.transactionStatus)"redirect"===o?(window.skipGetPaymentStatus=!1,window.top.location=t.paymentOption.redirectUrl,websdk_core.onPaymentEvent({eventType:"redirectionStarted"},I.onPaymentEvent,k,C,E)):"customRedirect"===o?n(O(t)):(window.skipGetPaymentStatus=!1,a.location=t.paymentOption.redirectUrl,websdk_core.onPaymentEvent({eventType:"redirectionStarted"},I.onPaymentEvent,k,C,E));else{try{a&&a.close()}catch(e){}t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},t.paymentOption.card.threeD=t.paymentOption.card.threeD||{};var t,e={result:(t=O(t)).transactionStatus,errCode:t.gwExtendedErrorCode||t.gwErrorCode||t.paymentMethodErrorCode||t.errorCode||"0",errorDescription:t.gwErrorReason||t.paymentMethodErrorReason||t.errorDescription||"",userPaymentOptionId:t.paymentOption.userPaymentOptionId,ccCardNumber:t.paymentOption.card.ccCardNumber,bin:t.paymentOption.card.bin,last4Digits:t.paymentOption.card.last4Digits||"",ccExpMonth:t.paymentOption.card.ccExpMonth||"",ccExpYear:t.paymentOption.card.ccExpYear||"",cavv:t.paymentOption.card.threeD.cavv||"",eci:t.paymentOption.card.threeD.eci||"",xid:t.paymentOption.card.threeD.xid||"",dsTransID:t.paymentOption.card.threeD.dsTransID||"",transactionId:t.transactionId,transactionStatus:t.transactionStatus,transactionType:t.transactionType,mcc:t.mcc||"",cancelled:!1};t.partialApproval&&(e.partialApproval=t.partialApproval),n(e)}}}else n(O(r.responseText))},delete e.apmWindowType,e.sourceApplication=I.sourceApplication||"WEB_SDK";var t=M("payment_started/payment_complete");window.clintPaymentDoId=t,r.send(JSON.stringify(e))}var o=!1;try{o=navigator.javaEnabled()}catch(e){}var r={acceptHeader:"Y",userAgent:navigator.userAgent,javaEnabled:o,language:navigator.language,colorDepth:screen.colorDepth,screenHeight:screen.height,screenWidth:screen.width,timeZone:(new Date).getTimezoneOffset(),javaScriptEnabled:!0};if(I.sourceMethod="createPayment",h.paymentOption&&h.paymentOption.__makePayment)T&&(h._validationState=T),h.browserDetails=r,h.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",h.paymentOption.__makePayment(I,h,function(e){f(O(e))});else if(h.paymentOption&&h.paymentOption.userPaymentOptionId&&h.paymentOption.card&&h.paymentOption.card.CVV&&h.paymentOption.card.CVV.__makePayment)T&&(h._validationState=T),h.browserDetails=r,h.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",h.paymentOption.card.CVV.__makePayment(I,h,function(e){f(O(e))});else if(h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&v.getDirectUPOs()[h.paymentOption.alternativePaymentMethod.paymentMethod]&&h.paymentOption.userPaymentOptionId)delete h._validationState,n(h,f);else if(h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&!e[h.paymentOption.alternativePaymentMethod.paymentMethod]&&!h.isDirectAPM&&"redirect"!==h.apmWindowType){delete h._validationState,h.billingAddress&&h.billingAddress.email&&h.paymentOption.subMethod&&void 0===h.paymentOption.subMethod.email&&"skrill1tap"===h.paymentOption.subMethod.subMethod.toLocaleLowerCase()&&(h.paymentOption.subMethod.email=h.billingAddress.email);var i,s=0;"object"!=typeof D.pollApm||"object"==typeof(m=D.pollApm[h.paymentOption.alternativePaymentMethod.paymentMethod])&&m.pollingCount===parseInt(m.pollingCount,10)&&m.pollingTime===parseInt(m.pollingTime,10)&&(i=m.pollingCount,s=m.pollingTime);var c=!0;clearTimeout(w);var p={w:800,h:600},d=p.w,o=p.h,l=screen.width/2-d/2,m=screen.height/2-o/2,p=websdk_core.findSfcHost()+"preloader.html?"+(new Date).getTime();h.apmPopupWindow?(a=h.apmPopupWindow,delete h.apmPopupWindow):"newTab"===h.apmWindowType?a=window.open(p,t):"customRedirect"!==h.apmWindowType&&(a=window.open(p,t,"height="+o+",width="+d+",top="+m+",left="+l+",toolbar=yes,location=no,directories=no,status=no,menubar=no,linemenubar=no,scrollbars=yes,resizable=yes,modal=yes")),!a&&void 0===event||!a&&event&&event.isTrusted,window.popupAPM=a,window.skipGetPaymentStatus=!0;var u=function(){websdk_core.onPaymentEvent({eventType:"redirectionEnded"},I.onPaymentEvent,k,C,E);var o=new XMLHttpRequest;o.open("POST",S+"/ppp/api/v1/getPaymentStatus.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){f({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},o.ontimeout=function(){return f({error:{type:"network",code:"connection_timeout",message:_}})},o.onload=function(){var e,t,n;200===o.status&&(n=(t=(e=O(JSON.parse(o.response))).paymentOption||{}).card||{},delete e.userTokenId,n=Object.assign(e,{result:e.transactionStatus||e.status,errCode:e.gwExtendedErrorCode||e.gwErrorCode||e.paymentMethodErrorCode||e.errorCode||e.errCode||"0",errorDescription:e.gwErrorReason||e.paymentMethodErrorReason||e.errorDescription||e.reason||"",userPaymentOptionId:t.userPaymentOptionId,ccCardNumber:n.ccCardNumber||"",bin:n.bin||"",last4Digits:n.last4Digits||"",ccExpMonth:n.ccExpMonth||"",ccExpYear:n.ccExpYear||"",transactionId:e.transactionId,cancelled:!1}),e.transactionStatus?delete e.transactionStatus:e.status&&delete e.status,e.gwExtendedErrorCode?delete e.gwExtendedErrorCode:e.gwErrorCode?delete e.gwErrorCode:e.paymentMethodErrorCode?delete e.paymentMethodErrorCode:e.errorCode&&delete e.errorCode,e.gwErrorReason?delete e.gwErrorReason:e.paymentMethodErrorReason?delete e.paymentMethodErrorReason:n.errorDescription===e.reason&&delete e.reason,c?(c=!1,f(n)):"PENDING"===n.result||"ERROR"===n.result||9072===n.errCode||f(n),i&&"PENDING"===n.result&&(w=setTimeout(u,1e3*s),i--))},o.send(JSON.stringify({sessionToken:h.sessionToken}))}.bind(this);!function e(t,n){window.setTimeout(function(){null==t||null==t.closed||1==t.closed?window.skipGetPaymentStatus||n():e(t,n)},200)}(a,u),n(h,f)}else if(h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&e[h.paymentOption.alternativePaymentMethod.paymentMethod]||h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&"redirect"===h.apmWindowType||h.paymentOption&&h.paymentOption.card&&h.paymentOption.card.externalToken&&h.paymentOption.card.externalToken.externalTokenProvider&&"GooglePay"!==h.paymentOption.card.externalToken.externalTokenProvider&&"ApplePay"!==h.paymentOption.card.externalToken.externalTokenProvider)delete h._validationState,n(h,f);else{var y=JSON.parse(JSON.stringify(h));if(y.paymentOption=y.paymentOption||{},y.paymentOption.useInitPayment=!0,delete y.shippingAddress,delete y.userDetails,delete y.useDCC,delete y.savePM,delete y._validationState,delete y.clientRequestId,delete y.applePay3Dflow,delete y.googlePay3Dflow,I.blockCards&&0<I.blockCards.length&&y.paymentOption.card&&y.paymentOption.card.cardNumber)v.getCardDetails({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,cardNumber:y.paymentOption.card.cardNumber},function(e){if("ERROR"===e.status||e.error&&"ERROR"===e.error.status){if(!0===I.strictCardBlocking)return void f(O({result:"ERROR",errCode:e.errCode||"0",errorDescription:e.errorDescription||e.reason||e.error&&e.error.message||""}))}else if(x(D.blockCards,e))return void f(O({errCode:-6,result:"ERROR",errDescription:R}));v.initPayment(y,function(e){var t;e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported&&websdk_core.onPaymentEvent({eventType:"3DSupported",threeD:{threeDSupported:"false"}},I.onPaymentEvent,k,C,E),!0===I.force3D&&e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&void 0===e.paymentOption.card.threeD.v2supported?f(O(e)):!0===I.force3D&&e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported?f(O({errorDescription:A})):(h.paymentOption=h.paymentOption||{},(t=JSON.parse(JSON.stringify(h))).paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},delete t.currency,delete t.amount,e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=r,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02","true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=S+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+e.sessionToken),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd)),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported&&delete t.paymentOption.card.threeD,n(t,f))})});else{l=h.applePay3Dflow,e=h.googlePay3Dflow;if(delete h.applePay3Dflow,delete h.googlePay3Dflow,h.paymentOption&&h.paymentOption.card&&h.paymentOption.card.externalToken&&("GooglePay"===h.paymentOption.card.externalToken.externalTokenProvider&&"disable"===e||"ApplePay"===h.paymentOption.card.externalToken.externalTokenProvider&&"enable"!==l)){l=JSON.parse(JSON.stringify(h));return delete l.currency,delete l.amount,void n(l,f)}v.initPayment(y,function(e){var t;e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported&&websdk_core.onPaymentEvent({eventType:"3DSupported",threeD:{threeDSupported:"false"}},I.onPaymentEvent,k,C,E),!0===D.force3D&&e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&void 0===e.paymentOption.card.threeD.v2supported?f(O(e)):!0===D.force3D&&e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported?f(O({errorDescription:A})):(h.paymentOption=h.paymentOption||{},(t=JSON.parse(JSON.stringify(h))).paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},delete t.currency,delete t.amount,e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=r,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02","true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=S+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+e.sessionToken),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd)),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&"false"===e.paymentOption.card.threeD.v2supported&&delete t.paymentOption.card.threeD,n(t,f))})}}}E=n(h),websdk_core.onPaymentEvent({eventType:"initiated"},I.onPaymentEvent,k,C,E),!0!==P.isProcessing?(P.isProcessing=!0,h.paymentOption.peers?h.paymentOption.peers.ccCvc?callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_THREE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_ONE_FIELDS"},null]):h.paymentOption.userPaymentOptionId?callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_UPO_PAYMENT"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_NOFIELDS"},null]),h.billingAddress&&h.billingAddress.email?(callDtrum("sendSessionProperties",[null,null,{usertokenid:h.billingAddress.email},null]),u("identifyUser",h.billingAddress.email+" / "+I.merchantId)):u("identifyUser",UUIDjs.create().hex.split("-")[0]+" / "+I.merchantId),h.sessionToken&&callDtrum("sendSessionProperties",[null,null,{sessiontoken:h.sessionToken},null]),v=this,h.openAmount?this.setOpenAmount({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,amount:h.openAmount,currency:h.currency,clientRequestId:h.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:h.clientUniqueId},function(e){"ERROR"===e.status?f(O(e)):t()}):t(),g=function(){!window.skipGetPaymentStatus||window.popupAPM&&!window.popupAPM.closed||(P={})}):f({processingOrder:!0})},initPayment:function(n,o){var r,e;delete n.addendums,n.paymentOption.card?((e=JSON.parse(JSON.stringify(n))).paymentOption.card.cardNumber="**** **** **** ****",e.paymentOption.card.expirationMonth="**",e.paymentOption.card.expirationYear="**",e.paymentOption.card.CVV="***",g.info("---\x3e initPayment input object\n"+JSON.stringify(e,null,4))):g.info("---\x3e initPayment input object\n"+JSON.stringify(n,null,4)),g.trace("---\x3e TRACE initPayment \n"),n.paymentOption&&n.paymentOption.__tokenize?n.paymentOption.__tokenize(I,n,function(e){o(e)}):n&&n.paymentOption&&(r=new XMLHttpRequest,e=S+"/ppp/api/v1/cardTokenization.do",(n.paymentOption.userPaymentOptionId||n.paymentOption.useInitPayment)&&(e=S+"/ppp/api/v1/websdk/initPaymentWithCardTokenization.do"),r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.timeout=6e4,r.onload=function(){if(U(window.initPaymentId),200!==r.status)return o(JSON.parse(r.responseText));var t=V(r.responseText);if("ERROR"===t.status)return t.error={type:"card",code:t.errCode},t.error.message=t.reason||"Process failed.",o(t);if("SUCCESS"!==t.status)return o(t);var e="";if(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.version&&(e=t.paymentOption.card.threeD.version),C=t.paymentOption.card.threeD.v2supported,websdk_core.onPaymentEvent({eventType:"tokenized",threeD:{version:e}},I.onPaymentEvent,k,C,E),t.transactionStatus&&(n.transactionStatus=t.transactionStatus),t.transactionType&&(n.transactionType=t.transactionType),t.transactionId&&(n.transactionId=t.transactionId),!(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.v2supported&&"true"===t.paymentOption.card.threeD.v2supported))return o(t);e=t.paymentOption.card.threeD;if(n.paymentOption=t.paymentOption||{},n.paymentOption.card=t.paymentOption.card||{},n.paymentOption.card.threeD=t.paymentOption.card.threeD||{},!e.methodUrl)return n.paymentOption.card.threeD.methodCompletionInd="U",o(n);e.methodUrl&&e.methodPayload&&j(e.methodUrl,e.methodPayload,function(e){return t.paymentOption.card.threeD.methodCompletionInd=e,o(t)})},r.ontimeout=function(){return U(window.initPaymentId),o({error:{type:"network",code:"connection_timeout",message:_}})},r.onerror=function(){U(window.initPaymentId),o({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:_})},n.sourceApplication=I.sourceApplication||"WEB_SDK",e=M("initPayment_started/initPayment_complete"),window.initPaymentId=e,r.send(JSON.stringify(n)))},paymentFrame:q,getToken:function(e,t){var n=e;return t&&t.billingAddress&&t.billingAddress.email?(callDtrum("sendSessionProperties",[null,null,{usertokenid:t.billingAddress.email},null]),u("identifyUser",t.billingAddress.email+" / "+I.merchantId)):u("identifyUser",UUIDjs.create().hex.split("-")[0]+" / "+I.merchantId),e.peers&&e.peers.ccCvc?callDtrum("sendSessionProperties",[null,null,{fieldstype:"getToken_THREE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"getToken_ONE_FIELDS"},null]),g.trace("---\x3e TRACE sfc.getToken() \n"),{then:function(e){if(t&&t.sessionToken&&(I.sessionToken=t.sessionToken),t&&t.merchantSiteId&&(I.merchantSiteId=t.merchantSiteId),!I.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!I.sessionToken)throw new Error("Session token is mandatory.");n.CVV&&n.CVV.__tokenize?((t=t||{}).userPaymentOptionId=n.userPaymentOptionId,t.expirationMonth=n.expirationMonth,t.expirationYear=n.expirationYear,n.CVV.__tokenize(I,t,e)):n.__tokenize(I,t,e)}}},setOpenAmount:function(e,t){"function"!=typeof t&&(t=function(){}),e.sessionToken=e.sessionToken||I.sessionToken,e.merchantId=e.merchantId||I.merchantId,e.merchantSiteId=e.merchantSiteId||I.merchantSiteId,setOrderAmount(S,e,t)},submitWdRequest:function(t,n){g.info("---\x3e submitWdRequest() input object---------------------- \n"+JSON.stringify(t,null,4)),g.trace("---\x3e submitWdRequest() stack trace---------------------- \n"),"function"!=typeof n&&(n=function(){});var e,o=JSON.parse(JSON.stringify(t));if(!o.amount)throw new Error("The amount is missing or invalid.");if(!o.currency)throw new Error("The currency is missing or invalid.");o.sessionToken=t.sessionToken||I.sessionToken,o.merchantId=t.merchantId||I.merchantId,o.merchantSiteId=t.merchantSiteId||I.merchantSiteId,o.userPMId=t.userPMId||t.upoId,delete o.upoId,"apmgw_PlayPlus"===t.paymentMethod&&sightlineNuvei&&sightlineNuvei.checkFields&&(sightlineNuvei.checkFields(),o.userDetails&&sightlineNuvei.sightlineParams&&sightlineNuvei.sightlineParams.userDetails&&(e=JSON.parse(JSON.stringify(o.userDetails)),o.userDetails=Object.assign(e,sightlineNuvei.sightlineParams.userDetails)));var r=new XMLHttpRequest;r.open("POST",S+"/ppp/api/v1/websdk/clientSubmitWdRequest.do",!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.timeout=6e4,r.onload=function(){var e;200===r.status?(e={result:(e=V(r.responseText)).status||"",wdRequestStatus:e.wdRequestStatus||"",errCode:e.errCode||"0",reason:e.reason||"",wdRequestId:e.wdRequestId||"",merchantWDRequestId:e.merchantWDRequestId||o.merchantWDRequestId||"",userAccountId:e.userAccountId||o.userAccountId||"",userId:e.userId||o.userId||""},n(e)):n(V(r.responseText))},r.ontimeout=function(){n({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},r.onabort=function(){n({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},r.onerror=function(){n({error:{status:"ERROR",type:"network",code:"connection_lost",message:_}})},"object"==typeof t&&Object.keys(t).forEach(function(e){H(e)&&(o[e]=t[e])}),r.send(JSON.stringify(o))},getWdRequests:function(e,t){g.info("---\x3e getWdRequests() input object---------------------- \n"+JSON.stringify(e,null,4)),g.trace("---\x3e getWdRequests() stack trace---------------------- \n"),"function"!=typeof t&&(t=function(){});var n=JSON.parse(JSON.stringify(e));if(!n.userTokenId)throw new Error("The userTokenId is missing or invalid.");n.sessionToken=e.sessionToken||I.sessionToken,n.merchantId=e.merchantId||I.merchantId,n.merchantSiteId=e.merchantSiteId||I.merchantSiteId;var o=new XMLHttpRequest;o.open("POST",S+"/ppp/api/v1/websdk/clientGetWdRequests.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onload=function(){t(V(o.responseText))},o.ontimeout=function(){t({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},o.onabort=function(){t({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},o.onerror=function(){t({error:{status:"ERROR",type:"network",code:"connection_lost",message:_}})},o.send(JSON.stringify(n))},cancelWdRequest:function(e,t){g.info("---\x3e cancelWdRequests() input object---------------------- \n"+JSON.stringify(e,null,4)),g.trace("---\x3e cancelWdRequests() stack trace---------------------- \n"),"function"!=typeof t&&(t=function(){});var n=JSON.parse(JSON.stringify(e));if(!n.userTokenId)throw new Error("The userTokenId is missing or invalid.");if(!n.wdRequestId)throw new Error("The wdRequestId is missing or invalid.");n.sessionToken=e.sessionToken||I.sessionToken,n.merchantId=e.merchantId||I.merchantId,n.merchantSiteId=e.merchantSiteId||I.merchantSiteId;var o=new XMLHttpRequest;o.open("POST",S+"/ppp/api/v1/websdk/clientCancelWdRequest.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onload=function(){t(V(o.responseText))},o.ontimeout=function(){t({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},o.onabort=function(){t({error:{status:"ERROR",type:"network",code:"connection_timeout",message:_}})},o.onerror=function(){t({error:{status:"ERROR",type:"network",code:"connection_lost",message:_}})},o.send(JSON.stringify(n))}}},e.SafeCharge.removeEvents=function(){window.removeEventListener("message",w,!1)},e.websdk=e.SafeCharge}(window);